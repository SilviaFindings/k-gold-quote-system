From 3f5eacbe5c97b493a0fb4a8510c83cfd5cd16c94 Mon Sep 17 00:00:00 2001
From: Marblee <3440803185179952-Marblee@noreply.coze.cn>
Date: Wed, 7 Jan 2026 12:02:34 +0800
Subject: [PATCH 01/13] =?UTF-8?q?fix:=20=E4=BF=AE=E6=AD=A3=E9=93=B6?=
 =?UTF-8?q?=E5=88=B6=E5=93=81=E6=8A=A5=E4=BB=B7=E9=A1=B5=E9=9D=A2=E8=BE=93?=
 =?UTF-8?q?=E5=85=A5=E6=A1=86=E6=96=87=E5=AD=97=E9=A2=9C=E8=89=B2=E4=B8=BA?=
 =?UTF-8?q?=E9=BB=91=E8=89=B2?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 src/app/silver-quote/page.tsx | 18 +++++++++---------
 1 file changed, 9 insertions(+), 9 deletions(-)

diff --git a/src/app/silver-quote/page.tsx b/src/app/silver-quote/page.tsx
index 6af0bba..2d276cd 100644
--- a/src/app/silver-quote/page.tsx
+++ b/src/app/silver-quote/page.tsx
@@ -468,7 +468,7 @@ function SilverQuotePage() {
                   setSilverPrice(value);
                   localStorage.setItem("silverPrice", value.toString());
                 }}
-                className="border border-gray-300 rounded px-3 py-2 w-32"
+                className="border border-gray-300 rounded px-3 py-2 w-32 text-black"
               />
             </div>
           </div>
@@ -488,7 +488,7 @@ function SilverQuotePage() {
                     setSilverCoefficients(updated);
                     localStorage.setItem("silverPriceCoefficients", JSON.stringify(updated));
                   }}
-                  className="border border-gray-300 rounded px-3 py-2 w-full"
+                  className="border border-gray-300 rounded px-3 py-2 w-full text-black"
                 />
               </div>
               <div>
@@ -502,7 +502,7 @@ function SilverQuotePage() {
                     setSilverCoefficients(updated);
                     localStorage.setItem("silverPriceCoefficients", JSON.stringify(updated));
                   }}
-                  className="border border-gray-300 rounded px-3 py-2 w-full"
+                  className="border border-gray-300 rounded px-3 py-2 w-full text-black"
                 />
               </div>
               <div>
@@ -516,7 +516,7 @@ function SilverQuotePage() {
                     setSilverCoefficients(updated);
                     localStorage.setItem("silverPriceCoefficients", JSON.stringify(updated));
                   }}
-                  className="border border-gray-300 rounded px-3 py-2 w-full"
+                  className="border border-gray-300 rounded px-3 py-2 w-full text-black"
                 />
               </div>
               <div>
@@ -530,7 +530,7 @@ function SilverQuotePage() {
                     setSilverCoefficients(updated);
                     localStorage.setItem("silverPriceCoefficients", JSON.stringify(updated));
                   }}
-                  className="border border-gray-300 rounded px-3 py-2 w-full"
+                  className="border border-gray-300 rounded px-3 py-2 w-full text-black"
                 />
               </div>
               <div>
@@ -544,7 +544,7 @@ function SilverQuotePage() {
                     setSilverCoefficients(updated);
                     localStorage.setItem("silverPriceCoefficients", JSON.stringify(updated));
                   }}
-                  className="border border-gray-300 rounded px-3 py-2 w-full"
+                  className="border border-gray-300 rounded px-3 py-2 w-full text-black"
                 />
               </div>
               <div>
@@ -558,7 +558,7 @@ function SilverQuotePage() {
                     setSilverCoefficients(updated);
                     localStorage.setItem("silverPriceCoefficients", JSON.stringify(updated));
                   }}
-                  className="border border-gray-300 rounded px-3 py-2 w-full"
+                  className="border border-gray-300 rounded px-3 py-2 w-full text-black"
                 />
               </div>
               <div>
@@ -572,7 +572,7 @@ function SilverQuotePage() {
                     setSilverCoefficients(updated);
                     localStorage.setItem("silverPriceCoefficients", JSON.stringify(updated));
                   }}
-                  className="border border-gray-300 rounded px-3 py-2 w-full"
+                  className="border border-gray-300 rounded px-3 py-2 w-full text-black"
                 />
               </div>
               <div>
@@ -586,7 +586,7 @@ function SilverQuotePage() {
                     setSilverCoefficients(updated);
                     localStorage.setItem("silverPriceCoefficients", JSON.stringify(updated));
                   }}
-                  className="border border-gray-300 rounded px-3 py-2 w-full"
+                  className="border border-gray-300 rounded px-3 py-2 w-full text-black"
                 />
               </div>
             </div>
-- 
2.43.0

From 04951afe5d1076e534eaf093e8457a82ceef3aa7 Mon Sep 17 00:00:00 2001
From: Marblee <3440803185179952-Marblee@noreply.coze.cn>
Date: Wed, 7 Jan 2026 12:04:12 +0800
Subject: [PATCH 02/13] =?UTF-8?q?fix:=20=E4=BF=AE=E6=AD=A3=E9=93=B6?=
 =?UTF-8?q?=E5=88=B6=E5=93=81=E6=8A=A5=E4=BB=B7=E9=A1=B5=E9=9D=A2=E6=89=80?=
 =?UTF-8?q?=E6=9C=89=E6=96=87=E5=AD=97=E9=A2=9C=E8=89=B2=E4=B8=BA=E9=BB=91?=
 =?UTF-8?q?=E8=89=B2?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 src/app/silver-quote/page.tsx | 40 +++++++++++++++++------------------
 1 file changed, 20 insertions(+), 20 deletions(-)

diff --git a/src/app/silver-quote/page.tsx b/src/app/silver-quote/page.tsx
index 2d276cd..38499ea 100644
--- a/src/app/silver-quote/page.tsx
+++ b/src/app/silver-quote/page.tsx
@@ -451,15 +451,15 @@ function SilverQuotePage() {
         <div className="max-w-7xl mx-auto">
           {/* é¡µé¢æ ‡é¢˜ */}
           <div className="mb-6">
-            <h1 className="text-3xl font-bold text-gray-900 mb-2">é“¶åˆ¶å“æŠ¥ä»·æ“ä½œå¹³å°</h1>
-            <p className="text-gray-600">925é“¶åˆ¶å“ä»·æ ¼è®¡ç®—å’Œç®¡ç†ç³»ç»Ÿ</p>
+            <h1 className="text-3xl font-bold text-black mb-2">é“¶åˆ¶å“æŠ¥ä»·æ“ä½œå¹³å°</h1>
+            <p className="text-black">925é“¶åˆ¶å“ä»·æ ¼è®¡ç®—å’Œç®¡ç†ç³»ç»Ÿ</p>
           </div>
 
           {/* é“¶ä»·é…ç½® */}
           <div className="bg-white rounded-lg shadow-md p-6 mb-6">
-            <h2 className="text-xl font-bold text-gray-900 mb-4">é“¶ä»·é…ç½®</h2>
+            <h2 className="text-xl font-bold text-black mb-4">é“¶ä»·é…ç½®</h2>
             <div className="flex items-center gap-4">
-              <label className="text-gray-700 font-medium">é“¶ä»·ï¼ˆäººæ°‘å¸/å…‹ï¼‰:</label>
+              <label className="text-black font-medium">é“¶ä»·ï¼ˆäººæ°‘å¸/å…‹ï¼‰:</label>
               <input
                 type="number"
                 value={silverPrice}
@@ -475,10 +475,10 @@ function SilverQuotePage() {
 
           {/* ç³»æ•°é…ç½® */}
           <div className="bg-white rounded-lg shadow-md p-6 mb-6">
-            <h2 className="text-xl font-bold text-gray-900 mb-4">ä»·æ ¼ç³»æ•°é…ç½®</h2>
+            <h2 className="text-xl font-bold text-black mb-4">ä»·æ ¼ç³»æ•°é…ç½®</h2>
             <div className="grid grid-cols-2 gap-4">
               <div>
-                <label className="block text-gray-700 mb-1">é›¶å”®å·¥è´¹ç³»æ•°</label>
+                <label className="block text-black mb-1">é›¶å”®å·¥è´¹ç³»æ•°</label>
                 <input
                   type="number"
                   step="0.1"
@@ -492,7 +492,7 @@ function SilverQuotePage() {
                 />
               </div>
               <div>
-                <label className="block text-gray-700 mb-1">æ‰¹å‘å·¥è´¹ç³»æ•°</label>
+                <label className="block text-black mb-1">æ‰¹å‘å·¥è´¹ç³»æ•°</label>
                 <input
                   type="number"
                   step="0.1"
@@ -506,7 +506,7 @@ function SilverQuotePage() {
                 />
               </div>
               <div>
-                <label className="block text-gray-700 mb-1">é“¶ææ–™æŸè€—ç³»æ•°</label>
+                <label className="block text-black mb-1">é“¶ææ–™æŸè€—ç³»æ•°</label>
                 <input
                   type="number"
                   step="0.01"
@@ -520,7 +520,7 @@ function SilverQuotePage() {
                 />
               </div>
               <div>
-                <label className="block text-gray-700 mb-1">ææ–™æµ®åŠ¨ç³»æ•°</label>
+                <label className="block text-black mb-1">ææ–™æµ®åŠ¨ç³»æ•°</label>
                 <input
                   type="number"
                   step="0.01"
@@ -534,7 +534,7 @@ function SilverQuotePage() {
                 />
               </div>
               <div>
-                <label className="block text-gray-700 mb-1">å›½é™…è¿è¾“å’Œå…³ç¨ç³»æ•°</label>
+                <label className="block text-black mb-1">å›½é™…è¿è¾“å’Œå…³ç¨ç³»æ•°</label>
                 <input
                   type="number"
                   step="0.01"
@@ -548,7 +548,7 @@ function SilverQuotePage() {
                 />
               </div>
               <div>
-                <label className="block text-gray-700 mb-1">æ±‡ç‡ï¼ˆäººæ°‘å¸/åŠ å¸ï¼‰</label>
+                <label className="block text-black mb-1">æ±‡ç‡ï¼ˆäººæ°‘å¸/åŠ å¸ï¼‰</label>
                 <input
                   type="number"
                   step="0.1"
@@ -562,7 +562,7 @@ function SilverQuotePage() {
                 />
               </div>
               <div>
-                <label className="block text-gray-700 mb-1">ä½£é‡‘ç³»æ•°ï¼ˆå·¥è´¹Ã—ç³»æ•°=ä½£é‡‘ï¼‰</label>
+                <label className="block text-black mb-1">ä½£é‡‘ç³»æ•°ï¼ˆå·¥è´¹Ã—ç³»æ•°=ä½£é‡‘ï¼‰</label>
                 <input
                   type="number"
                   step="0.1"
@@ -576,7 +576,7 @@ function SilverQuotePage() {
                 />
               </div>
               <div>
-                <label className="block text-gray-700 mb-1">çŸ³å¤´åŠ æˆç³»æ•°</label>
+                <label className="block text-black mb-1">çŸ³å¤´åŠ æˆç³»æ•°</label>
                 <input
                   type="number"
                   step="0.1"
@@ -594,11 +594,11 @@ function SilverQuotePage() {
 
           {/* è®¡ç®—å…¬å¼å±•ç¤º */}
           <div className="bg-white rounded-lg shadow-md p-6 mb-6">
-            <h2 className="text-xl font-bold text-gray-900 mb-4">è®¡ç®—å…¬å¼</h2>
+            <h2 className="text-xl font-bold text-black mb-4">è®¡ç®—å…¬å¼</h2>
             <div className="space-y-4">
               <div className="border-l-4 border-blue-500 pl-4">
-                <h3 className="font-bold text-gray-900 mb-2">é€šç”¨é“¶åˆ¶å“ï¼ˆäººæ°‘å¸åŸºæ•°ä¸ºåŠ å¸ï¼‰</h3>
-                <div className="bg-gray-50 p-4 rounded text-sm space-y-2">
+                <h3 className="font-bold text-black mb-2">é€šç”¨é“¶åˆ¶å“ï¼ˆäººæ°‘å¸åŸºæ•°ä¸ºåŠ å¸ï¼‰</h3>
+                <div className="bg-gray-50 p-4 rounded text-sm space-y-2 text-black">
                   <p><strong>ææ–™ä»·</strong> = é“¶ä»· Ã— å…‹é‡ Ã— 1.05 Ã— 1.1</p>
                   <p><strong>ä½£é‡‘</strong> = å·¥è´¹ Ã— 1.1</p>
                   <p><strong>é›¶å”®ä»·</strong> = ææ–™ä»·/5 + (å·¥è´¹/5 + é…ä»¶/5 + ç”µé•€/5) Ã— 5 + çŸ³å¤´/5 Ã— 1.3 + ä½£é‡‘/5</p>
@@ -606,11 +606,11 @@ function SilverQuotePage() {
                 </div>
               </div>
               <div className="border-l-4 border-green-500 pl-4">
-                <h3 className="font-bold text-gray-900 mb-2">Tå­—å¤´ä¾›åº”å•†ï¼ˆç¾é‡‘åŸºæ•°æŠ˜åŠ å¸ï¼‰</h3>
-                <div className="bg-gray-50 p-4 rounded text-sm space-y-2">
+                <h3 className="font-bold text-black mb-2">Tå­—å¤´ä¾›åº”å•†ï¼ˆç¾é‡‘åŸºæ•°æŠ˜åŠ å¸ï¼‰</h3>
+                <div className="bg-gray-50 p-4 rounded text-sm space-y-2 text-black">
                   <p><strong>é›¶å”®ä»·</strong> = (ææ–™ä»· Ã— 1.15 Ã— 1.1 + å·¥è´¹ Ã— 5 + å…¶ä»–æˆæœ¬) Ã— 1.25 Ã— 1.4ï¼ˆç¾é‡‘æŠ˜åŠ å¸ï¼‰</p>
                   <p><strong>æ‰¹å‘ä»·</strong> = (ææ–™ä»· Ã— 1.15 Ã— 1.1 + å·¥è´¹ Ã— 3 + å…¶ä»–æˆæœ¬) Ã— 1.25 Ã— 1.4ï¼ˆç¾é‡‘æŠ˜åŠ å¸ï¼‰</p>
-                  <p className="text-gray-600 mt-2">å…¶ä¸­ï¼šå…¶ä»–æˆæœ¬ = (é…ä»¶ + çŸ³å¤´ + ç”µé•€ + ä½£é‡‘) Ã— 1.15</p>
+                  <p className="text-black mt-2">å…¶ä¸­ï¼šå…¶ä»–æˆæœ¬ = (é…ä»¶ + çŸ³å¤´ + ç”µé•€ + ä½£é‡‘) Ã— 1.15</p>
                 </div>
               </div>
             </div>
@@ -618,7 +618,7 @@ function SilverQuotePage() {
 
           {/* æµ‹è¯•åŒºåŸŸ */}
           <div className="bg-white rounded-lg shadow-md p-6 mb-6">
-            <h2 className="text-xl font-bold text-gray-900 mb-4">æµ‹è¯•è®¡ç®—</h2>
+            <h2 className="text-xl font-bold text-black mb-4">æµ‹è¯•è®¡ç®—</h2>
             <button
               onClick={() => {
                 const testProduct: SilverProduct = {
-- 
2.43.0

From e2690bbce722216a70704bd8684f63f5029d6b0c Mon Sep 17 00:00:00 2001
From: Marblee <3440803185179952-Marblee@noreply.coze.cn>
Date: Wed, 7 Jan 2026 12:09:16 +0800
Subject: [PATCH 03/13] =?UTF-8?q?feat:=20=E5=AE=8C=E6=88=90=E9=93=B6?=
 =?UTF-8?q?=E5=88=B6=E5=93=81=E6=8A=A5=E4=BB=B7=E5=B9=B3=E5=8F=B0=E6=89=80?=
 =?UTF-8?q?=E6=9C=89=E5=8A=9F=E8=83=BD=E5=BC=80=E5=8F=91?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 src/app/silver-quote/page.tsx | 743 +++++++++++++++++++++++++++++++++-
 1 file changed, 739 insertions(+), 4 deletions(-)

diff --git a/src/app/silver-quote/page.tsx b/src/app/silver-quote/page.tsx
index 38499ea..4c5eb01 100644
--- a/src/app/silver-quote/page.tsx
+++ b/src/app/silver-quote/page.tsx
@@ -440,19 +440,479 @@ function SilverQuotePage() {
     }
   };
 
-  // ========== é¡µé¢UI ==========
+  // ========== äº§å“å’Œå†å²è®°å½•çŠ¶æ€ç®¡ç† ==========
 
   const [products, setProducts] = useState<SilverProduct[]>([]);
+  const [priceHistory, setPriceHistory] = useState<SilverPriceHistory[]>([]);
   const [currentCategory, setCurrentCategory] = useState<SilverProductCategory>("é…ä»¶");
+  const [currentSubCategory, setCurrentSubCategory] = useState<string | null>(null);
+
+  // æ·»åŠ äº§å“
+  const addProduct = () => {
+    const newProduct: SilverProduct = {
+      id: Date.now().toString(),
+      category: currentCategory,
+      subCategory: SILVER_SUB_CATEGORIES[currentCategory][0],
+      productCode: "",
+      productName: "",
+      specification: "",
+      weight: 0,
+      laborCost: 0,
+      silverColor: "é“¶è‰²",
+      silverPrice: silverPrice,
+      wholesalePrice: 0,
+      retailPrice: 0,
+      accessoryCost: 0,
+      stoneCost: 0,
+      platingCost: 0,
+      moldCost: 0,
+      commission: 0,
+      supplierCode: "E1",
+      remarks: "",
+      quantity: 0,
+      quantityDate: "",
+      laborCostDate: "",
+      accessoryCostDate: "",
+      stoneCostDate: "",
+      platingCostDate: "",
+      moldCostDate: "",
+      commissionDate: "",
+      timestamp: new Date().toISOString(),
+    };
+
+    setProducts([...products, newProduct]);
+  };
+
+  // æ›´æ–°äº§å“
+  const updateProduct = (id: string, field: keyof SilverProduct, value: any) => {
+    const updatedProducts = products.map(p => {
+      if (p.id === id) {
+        const updated = { ...p, [field]: value };
+
+        // æ™ºèƒ½è¯†åˆ«è´§å·å’Œåˆ†ç±»
+        if (field === "productCode" && value) {
+          const parsed = parseSilverProductCode(value);
+          updated.supplierCode = parsed.supplierCode;
+        }
+
+        // æ™ºèƒ½è¯†åˆ«äº§å“åç§°å¯¹åº”çš„åˆ†ç±»
+        if (field === "productName" && value) {
+          const detectedCategory = detectSilverCategoryFromName(value);
+          const detectedSubCategory = detectSilverSubCategoryFromName(value);
+          if (detectedCategory) {
+            updated.category = detectedCategory;
+          }
+          if (detectedSubCategory) {
+            updated.subCategory = detectedSubCategory;
+          }
+        }
+
+        // è‡ªåŠ¨è®¡ç®—ä»·æ ¼
+        updated.retailPrice = calculateSilverPrice(updated, true);
+        updated.wholesalePrice = calculateSilverPrice(updated, false);
+
+        return updated;
+      }
+      return p;
+    });
+
+    setProducts(updatedProducts);
+    saveToLocalStorage(updatedProducts);
+  };
+
+  // åˆ é™¤äº§å“
+  const deleteProduct = (id: string) => {
+    if (window.confirm("ç¡®è®¤åˆ é™¤æ­¤äº§å“ï¼Ÿ")) {
+      setProducts(products.filter(p => p.id !== id));
+      setPriceHistory(priceHistory.filter(h => h.productId !== id));
+      saveToLocalStorage(products.filter(p => p.id !== id), priceHistory.filter(h => h.productId !== id));
+    }
+  };
+
+  // ä¿å­˜å†å²è®°å½•
+  const saveToHistory = (product: SilverProduct) => {
+    const historyItem: SilverPriceHistory = {
+      id: Date.now().toString(),
+      productId: product.id,
+      category: product.category,
+      subCategory: product.subCategory,
+      productCode: product.productCode,
+      productName: product.productName,
+      specification: product.specification,
+      weight: product.weight,
+      laborCost: product.laborCost,
+      silverColor: product.silverColor,
+      silverPrice: product.silverPrice,
+      wholesalePrice: product.wholesalePrice,
+      retailPrice: product.retailPrice,
+      accessoryCost: product.accessoryCost,
+      stoneCost: product.stoneCost,
+      platingCost: product.platingCost,
+      moldCost: product.moldCost,
+      commission: product.commission,
+      supplierCode: product.supplierCode,
+      remarks: product.remarks,
+      quantity: product.quantity,
+      quantityDate: product.quantityDate,
+      laborCostDate: product.laborCostDate,
+      accessoryCostDate: product.accessoryCostDate,
+      stoneCostDate: product.stoneCostDate,
+      platingCostDate: product.platingCostDate,
+      moldCostDate: product.moldCostDate,
+      commissionDate: product.commissionDate,
+      timestamp: new Date().toISOString(),
+    };
+
+    setPriceHistory([historyItem, ...priceHistory]);
+    saveToLocalStorage(products, [historyItem, ...priceHistory]);
+  };
+
+  // æœ¬åœ°å­˜å‚¨æ“ä½œ
+  const saveToLocalStorage = (productsList?: SilverProduct[], historyList?: SilverPriceHistory[]) => {
+    const prods = productsList || products;
+    const hist = historyList || priceHistory;
+
+    localStorage.setItem("silverProducts", JSON.stringify(prods));
+    localStorage.setItem("silverPriceHistory", JSON.stringify(hist));
+  };
+
+  // ========== äº‘ç«¯åŒæ­¥åŠŸèƒ½ ==========
+
+  const [showSyncMenu, setShowSyncMenu] = useState(false);
+  const [cloudDataExists, setCloudDataExists] = useState(false);
+  const [syncStatus, setSyncStatus] = useState<"idle" | "syncing" | "success" | "error">("idle");
+  const [syncMessage, setSyncMessage] = useState("");
+
+  // æ£€æŸ¥äº‘ç«¯æ•°æ®æ˜¯å¦å­˜åœ¨
+  const checkCloudData = async () => {
+    try {
+      const token = localStorage.getItem('auth_token');
+      if (!token) {
+        setCloudDataExists(false);
+        return;
+      }
+
+      const response = await fetch('/api/silver-products?limit=1', {
+        headers: {
+          Authorization: `Bearer ${token}`,
+        }
+      });
+
+      if (response.ok) {
+        const data = await response.json();
+        setCloudDataExists(data && data.length > 0);
+      }
+    } catch (error) {
+      console.error('æ£€æŸ¥äº‘ç«¯æ•°æ®å¤±è´¥:', error);
+      setCloudDataExists(false);
+    }
+  };
+
+  // ä¸Šä¼ æ•°æ®åˆ°äº‘ç«¯
+  const uploadToCloud = async () => {
+    setSyncStatus("syncing");
+    setSyncMessage("æ­£åœ¨ä¸Šä¼ æ•°æ®åˆ°äº‘ç«¯...");
+
+    try {
+      const token = localStorage.getItem('auth_token');
+      if (!token) {
+        alert('è¯·å…ˆç™»å½•');
+        setSyncStatus("error");
+        setSyncMessage("éœ€è¦ç™»å½•");
+        return;
+      }
+
+      // ä¸Šä¼ é“¶åˆ¶å“æ•°æ®
+      const response = await fetch('/api/silver-sync', {
+        method: 'POST',
+        headers: {
+          'Content-Type': 'application/json',
+          'Authorization': `Bearer ${token}`,
+        },
+        body: JSON.stringify({
+          products: products,
+          history: priceHistory,
+          silverPrice: silverPrice,
+          coefficients: silverCoefficients,
+        }),
+      });
+
+      if (response.ok) {
+        setSyncStatus("success");
+        setSyncMessage("æ•°æ®ä¸Šä¼ æˆåŠŸï¼");
+        setCloudDataExists(true);
+        setTimeout(() => {
+          setSyncStatus("idle");
+          setSyncMessage("");
+          setShowSyncMenu(false);
+        }, 2000);
+      } else {
+        throw new Error('ä¸Šä¼ å¤±è´¥');
+      }
+    } catch (error) {
+      console.error('ä¸Šä¼ åˆ°äº‘ç«¯å¤±è´¥:', error);
+      setSyncStatus("error");
+      setSyncMessage("ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•");
+    }
+  };
+
+  // ä»äº‘ç«¯ä¸‹è½½æ•°æ®
+  const downloadFromCloud = async (mode: "replace" | "merge") => {
+    setSyncStatus("syncing");
+    setSyncMessage("æ­£åœ¨ä»äº‘ç«¯ä¸‹è½½æ•°æ®...");
+
+    try {
+      const token = localStorage.getItem('auth_token');
+      if (!token) {
+        alert('è¯·å…ˆç™»å½•');
+        setSyncStatus("error");
+        setSyncMessage("éœ€è¦ç™»å½•");
+        return;
+      }
+
+      const response = await fetch('/api/silver-sync', {
+        headers: {
+          'Authorization': `Bearer ${token}`,
+        }
+      });
+
+      if (response.ok) {
+        const data = await response.json();
+
+        if (mode === "replace") {
+          setProducts(data.products || []);
+          setPriceHistory(data.history || []);
+          setSilverPrice(data.silverPrice || 20);
+          setSilverCoefficients(data.coefficients || silverCoefficients);
+        } else {
+          // åˆå¹¶æ¨¡å¼ï¼šä¿ç•™æœ¬åœ°æ•°æ®ï¼Œæ·»åŠ äº‘ç«¯ä¸å­˜åœ¨çš„æ•°æ®
+          const existingIds = new Set(products.map(p => p.id));
+          const newProducts = (data.products || []).filter((p: SilverProduct) => !existingIds.has(p.id));
+          setProducts([...products, ...newProducts]);
+          setPriceHistory([...priceHistory, ...(data.history || [])]);
+        }
+
+        setSyncStatus("success");
+        setSyncMessage("æ•°æ®ä¸‹è½½æˆåŠŸï¼");
+        setTimeout(() => {
+          setSyncStatus("idle");
+          setSyncMessage("");
+          setShowSyncMenu(false);
+        }, 2000);
+      } else {
+        throw new Error('ä¸‹è½½å¤±è´¥');
+      }
+    } catch (error) {
+      console.error('ä»äº‘ç«¯ä¸‹è½½å¤±è´¥:', error);
+      setSyncStatus("error");
+      setSyncMessage("ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•");
+    }
+  };
+
+  // åˆå§‹åŒ–æ—¶æ£€æŸ¥äº‘ç«¯æ•°æ®
+  useEffect(() => {
+    checkCloudData();
+  }, []);
+
+  // åŠ è½½æœ¬åœ°æ•°æ®
+  useEffect(() => {
+    if (typeof window !== 'undefined') {
+      const savedProducts = localStorage.getItem("silverProducts");
+      const savedHistory = localStorage.getItem("silverPriceHistory");
+
+      if (savedProducts) {
+        setProducts(JSON.parse(savedProducts));
+      }
+      if (savedHistory) {
+        setPriceHistory(JSON.parse(savedHistory));
+      }
+    }
+  }, []);
+
+  // æ ¼å¼åŒ–æ—¥æœŸ
+  const formatDate = (dateString: string) => {
+    if (!dateString) return "-";
+    const date = new Date(dateString);
+    return date.toLocaleString("zh-CN", {
+      year: 'numeric',
+      month: '2-digit',
+      day: '2-digit',
+      hour: '2-digit',
+      minute: '2-digit'
+    });
+  };
+
+  // Excel å¯¼å‡º
+  const exportToExcel = () => {
+    const filteredProducts = products.filter(p => p.category === currentCategory);
+
+    if (filteredProducts.length === 0) {
+      alert("æ²¡æœ‰æ•°æ®å¯å¯¼å‡º");
+      return;
+    }
+
+    const data = filteredProducts.map(p => ({
+      "åˆ†ç±»": p.category,
+      "å­åˆ†ç±»": p.subCategory,
+      "è´§å·": p.productCode,
+      "äº§å“åç§°": p.productName,
+      "è§„æ ¼": p.specification,
+      "å…‹é‡": p.weight,
+      "å·¥è´¹": p.laborCost,
+      "é“¶è‰²": p.silverColor,
+      "é“¶ä»·": p.silverPrice,
+      "é…ä»¶æˆæœ¬": p.accessoryCost,
+      "çŸ³å¤´æˆæœ¬": p.stoneCost,
+      "ç”µé•€æˆæœ¬": p.platingCost,
+      "ä¾›åº”å•†ä»£ç ": p.supplierCode,
+      "é›¶å”®ä»·(CAD$)": p.retailPrice.toFixed(2),
+      "æ‰¹å‘ä»·(CAD$)": p.wholesalePrice.toFixed(2),
+      "å¤‡æ³¨": p.remarks,
+      "ç´¯è®¡æ•°é‡": p.quantity,
+      "æ›´æ–°æ—¶é—´": formatDate(p.timestamp),
+    }));
+
+    const ws = XLSX.utils.json_to_sheet(data);
+    const wb = XLSX.utils.book_new();
+    XLSX.utils.book_append_sheet(wb, ws, "é“¶åˆ¶å“åˆ—è¡¨");
+    XLSX.writeFile(wb, `é“¶åˆ¶å“æŠ¥ä»·_${currentCategory}_${new Date().toISOString().slice(0, 10)}.xlsx`);
+  };
+
+  // Excel å¯¼å…¥
+  const handleExcelImport = (e: React.ChangeEvent<HTMLInputElement>) => {
+    const file = e.target.files?.[0];
+    if (!file) return;
+
+    const reader = new FileReader();
+    reader.onload = (event) => {
+      const data = event.target?.result;
+      const workbook = XLSX.read(data, { type: 'binary' });
+      const sheetName = workbook.SheetNames[0];
+      const sheet = workbook.Sheets[sheetName];
+      const jsonData = XLSX.utils.sheet_to_json(sheet);
+
+      const importedProducts: SilverProduct[] = jsonData.map((row: any, index) => ({
+        id: Date.now().toString() + index,
+        category: row["åˆ†ç±»"] || row["åˆ†ç±»"] || currentCategory,
+        subCategory: row["å­åˆ†ç±»"] || row["å­åˆ†ç±»"] || SILVER_SUB_CATEGORIES[currentCategory][0],
+        productCode: row["è´§å·"] || "",
+        productName: row["äº§å“åç§°"] || "",
+        specification: row["è§„æ ¼"] || "",
+        weight: Number(row["å…‹é‡"]) || 0,
+        laborCost: Number(row["å·¥è´¹"]) || 0,
+        silverColor: row["é“¶è‰²"] || "é“¶è‰²",
+        silverPrice: silverPrice,
+        wholesalePrice: 0,
+        retailPrice: 0,
+        accessoryCost: Number(row["é…ä»¶æˆæœ¬"]) || 0,
+        stoneCost: Number(row["çŸ³å¤´æˆæœ¬"]) || 0,
+        platingCost: Number(row["ç”µé•€æˆæœ¬"]) || 0,
+        moldCost: 0,
+        commission: 0,
+        supplierCode: row["ä¾›åº”å•†ä»£ç "] || "E1",
+        remarks: row["å¤‡æ³¨"] || "",
+        quantity: Number(row["ç´¯è®¡æ•°é‡"]) || 0,
+        quantityDate: "",
+        laborCostDate: "",
+        accessoryCostDate: "",
+        stoneCostDate: "",
+        platingCostDate: "",
+        moldCostDate: "",
+        commissionDate: "",
+        timestamp: new Date().toISOString(),
+      }));
+
+      // è®¡ç®—ä»·æ ¼
+      const withPrices = importedProducts.map(p => ({
+        ...p,
+        retailPrice: calculateSilverPrice(p, true),
+        wholesalePrice: calculateSilverPrice(p, false),
+      }));
+
+      setProducts([...products, ...withPrices]);
+      saveToLocalStorage([...products, ...withPrices]);
+      alert(`æˆåŠŸå¯¼å…¥ ${importedProducts.length} ä¸ªäº§å“`);
+    };
+    reader.readAsBinaryString(file);
+  };
+
+  // ========== é¡µé¢UI ==========
 
   return (
     <div className="min-h-screen bg-gray-50 p-6">
       <AuthProtection>
         <div className="max-w-7xl mx-auto">
           {/* é¡µé¢æ ‡é¢˜ */}
-          <div className="mb-6">
-            <h1 className="text-3xl font-bold text-black mb-2">é“¶åˆ¶å“æŠ¥ä»·æ“ä½œå¹³å°</h1>
-            <p className="text-black">925é“¶åˆ¶å“ä»·æ ¼è®¡ç®—å’Œç®¡ç†ç³»ç»Ÿ</p>
+          <div className="mb-6 flex items-center justify-between">
+            <div>
+              <h1 className="text-3xl font-bold text-black mb-2">é“¶åˆ¶å“æŠ¥ä»·æ“ä½œå¹³å°</h1>
+              <p className="text-black">925é“¶åˆ¶å“ä»·æ ¼è®¡ç®—å’Œç®¡ç†ç³»ç»Ÿ</p>
+            </div>
+            <div className="relative">
+              <button
+                onClick={() => {
+                  setShowSyncMenu(!showSyncMenu);
+                  checkCloudData();
+                }}
+                className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 flex items-center gap-2"
+              >
+                <span>â˜ï¸</span>
+                <span>äº‘ç«¯åŒæ­¥</span>
+              </button>
+
+              {/* äº‘ç«¯åŒæ­¥èœå• */}
+              {showSyncMenu && (
+                <div className="absolute right-0 mt-2 w-72 bg-white rounded-lg shadow-lg border border-gray-200 z-50">
+                  <div className="py-3">
+                    <div className="px-4 pb-2 border-b border-gray-200">
+                      <div className="text-sm font-semibold text-black">äº‘ç«¯æ•°æ®åŒæ­¥</div>
+                      {cloudDataExists && (
+                        <div className="text-xs text-green-600 mt-1">âœ“ äº‘ç«¯å·²æœ‰æ•°æ®</div>
+                      )}
+                    </div>
+
+                    {/* åŒæ­¥çŠ¶æ€æ¶ˆæ¯ */}
+                    {syncStatus !== "idle" && (
+                      <div className="px-4 py-2">
+                        <div className={`text-sm ${syncStatus === "error" ? "text-red-600" : syncStatus === "success" ? "text-green-600" : "text-blue-600"}`}>
+                          {syncMessage}
+                        </div>
+                      </div>
+                    )}
+
+                    <div className="px-4 py-2 space-y-1">
+                      <button
+                        onClick={uploadToCloud}
+                        disabled={syncStatus === "syncing"}
+                        className="w-full text-left px-3 py-2 rounded hover:bg-blue-50 text-black text-sm disabled:opacity-50"
+                      >
+                        ğŸ“¤ ä¸Šä¼ åˆ°äº‘ç«¯
+                      </button>
+                      <button
+                        onClick={() => downloadFromCloud("merge")}
+                        disabled={syncStatus === "syncing"}
+                        className="w-full text-left px-3 py-2 rounded hover:bg-green-50 text-black text-sm disabled:opacity-50"
+                      >
+                        ğŸ“¥ åˆå¹¶ä¸‹è½½ï¼ˆä¿ç•™æœ¬åœ°ï¼‰
+                      </button>
+                      <button
+                        onClick={() => downloadFromCloud("replace")}
+                        disabled={syncStatus === "syncing"}
+                        className="w-full text-left px-3 py-2 rounded hover:bg-orange-50 text-black text-sm disabled:opacity-50"
+                      >
+                        ğŸ”„ è¦†ç›–ä¸‹è½½ï¼ˆæ›¿æ¢æœ¬åœ°ï¼‰
+                      </button>
+                    </div>
+
+                    <div className="px-4 pt-2 border-t border-gray-200">
+                      <div className="text-xs text-gray-500">
+                        ä¸Šä¼ åŒ…å«ï¼šäº§å“æ•°æ®ã€å†å²è®°å½•ã€é“¶ä»·è®¾ç½®ã€ä»·æ ¼ç³»æ•°
+                      </div>
+                    </div>
+                  </div>
+                </div>
+              )}
+            </div>
           </div>
 
           {/* é“¶ä»·é…ç½® */}
@@ -663,6 +1123,281 @@ function SilverQuotePage() {
             </button>
           </div>
 
+          {/* äº§å“æ“ä½œåŒº */}
+          <div className="bg-white rounded-lg shadow-md p-6 mb-6">
+            <div className="flex items-center justify-between mb-4">
+              <h2 className="text-xl font-bold text-black">äº§å“ç®¡ç†</h2>
+              <div className="flex gap-2">
+                <button
+                  onClick={addProduct}
+                  className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
+                >
+                  æ·»åŠ äº§å“
+                </button>
+                <button
+                  onClick={exportToExcel}
+                  className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600"
+                >
+                  å¯¼å‡ºExcel
+                </button>
+                <label className="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 cursor-pointer">
+                  å¯¼å…¥Excel
+                  <input type="file" accept=".xlsx,.xls" onChange={handleExcelImport} className="hidden" />
+                </label>
+              </div>
+            </div>
+
+            {/* åˆ†ç±»é€‰æ‹© */}
+            <div className="flex items-center gap-4 mb-4">
+              <span className="text-black font-medium">é€‰æ‹©åˆ†ç±»:</span>
+              <div className="flex gap-2">
+                {SILVER_PRODUCT_CATEGORIES.map(cat => (
+                  <button
+                    key={cat}
+                    onClick={() => {
+                      setCurrentCategory(cat);
+                      setCurrentSubCategory(null);
+                    }}
+                    className={`px-4 py-2 rounded ${currentCategory === cat ? 'bg-blue-500 text-white' : 'bg-gray-200 text-black hover:bg-gray-300'}`}
+                  >
+                    {cat}
+                  </button>
+                ))}
+              </div>
+            </div>
+
+            {/* å­åˆ†ç±»é€‰æ‹© */}
+            {currentCategory && SILVER_SUB_CATEGORIES[currentCategory] && (
+              <div className="flex items-center gap-4 mb-4">
+                <span className="text-black font-medium">é€‰æ‹©å­åˆ†ç±»:</span>
+                <div className="flex gap-2 flex-wrap">
+                  <button
+                    onClick={() => setCurrentSubCategory(null)}
+                    className={`px-3 py-1 rounded text-sm ${currentSubCategory === null ? 'bg-blue-500 text-white' : 'bg-gray-200 text-black hover:bg-gray-300'}`}
+                  >
+                    å…¨éƒ¨
+                  </button>
+                  {SILVER_SUB_CATEGORIES[currentCategory].map(subCat => (
+                    <button
+                      key={subCat}
+                      onClick={() => setCurrentSubCategory(subCat)}
+                      className={`px-3 py-1 rounded text-sm ${currentSubCategory === subCat ? 'bg-blue-500 text-white' : 'bg-gray-200 text-black hover:bg-gray-300'}`}
+                    >
+                      {subCat}
+                    </button>
+                  ))}
+                </div>
+              </div>
+            )}
+          </div>
+
+          {/* äº§å“åˆ—è¡¨ */}
+          <div className="bg-white rounded-lg shadow-md p-6 mb-6">
+            <h2 className="text-xl font-bold text-black mb-4">äº§å“åˆ—è¡¨</h2>
+            <div className="overflow-x-auto">
+              <table className="w-full border-collapse border border-gray-200 text-sm">
+                <thead className="bg-gray-100">
+                  <tr>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black">æ“ä½œ</th>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black">è´§å·</th>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black">äº§å“åç§°</th>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black">è§„æ ¼</th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">å…‹é‡</th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">å·¥è´¹</th>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black">é“¶è‰²</th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">é…ä»¶æˆæœ¬</th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">çŸ³å¤´æˆæœ¬</th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">ç”µé•€æˆæœ¬</th>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black">ä¾›åº”å•†ä»£ç </th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">é›¶å”®ä»·(CAD$)</th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">æ‰¹å‘ä»·(CAD$)</th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">ç´¯è®¡æ•°é‡</th>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black">å¤‡æ³¨</th>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black">æ›´æ–°æ—¶é—´</th>
+                  </tr>
+                </thead>
+                <tbody>
+                  {products.filter(p => {
+                    if (p.category !== currentCategory) return false;
+                    if (currentSubCategory && p.subCategory !== currentSubCategory) return false;
+                    return true;
+                  }).map(product => (
+                    <tr key={product.id}>
+                      <td className="border border-gray-200 px-3 py-2">
+                        <button
+                          onClick={() => deleteProduct(product.id)}
+                          className="text-red-500 hover:text-red-700"
+                        >
+                          åˆ é™¤
+                        </button>
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2">
+                        <input
+                          type="text"
+                          value={product.productCode}
+                          onChange={(e) => updateProduct(product.id, "productCode", e.target.value)}
+                          className="w-full border border-gray-200 rounded px-2 py-1 text-black"
+                        />
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2">
+                        <input
+                          type="text"
+                          value={product.productName}
+                          onChange={(e) => updateProduct(product.id, "productName", e.target.value)}
+                          className="w-full border border-gray-200 rounded px-2 py-1 text-black"
+                        />
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2">
+                        <input
+                          type="text"
+                          value={product.specification}
+                          onChange={(e) => updateProduct(product.id, "specification", e.target.value)}
+                          className="w-full border border-gray-200 rounded px-2 py-1 text-black"
+                        />
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2">
+                        <input
+                          type="number"
+                          step="0.01"
+                          value={product.weight}
+                          onChange={(e) => updateProduct(product.id, "weight", Number(e.target.value))}
+                          className="w-full border border-gray-200 rounded px-2 py-1 text-black text-right"
+                        />
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2">
+                        <input
+                          type="number"
+                          step="0.01"
+                          value={product.laborCost}
+                          onChange={(e) => updateProduct(product.id, "laborCost", Number(e.target.value))}
+                          className="w-full border border-gray-200 rounded px-2 py-1 text-black text-right"
+                        />
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2">
+                        <select
+                          value={product.silverColor}
+                          onChange={(e) => updateProduct(product.id, "silverColor", e.target.value as any)}
+                          className="w-full border border-gray-200 rounded px-2 py-1 text-black"
+                        >
+                          <option value="é“¶è‰²">é“¶è‰²</option>
+                          <option value="é•€é‡‘">é•€é‡‘</option>
+                          <option value="é•€ç«ç‘°é‡‘">é•€ç«ç‘°é‡‘</option>
+                          <option value="é“¶è‰²/é•€é‡‘/é•€ç«ç‘°é‡‘">é“¶è‰²/é•€é‡‘/é•€ç«ç‘°é‡‘</option>
+                        </select>
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2">
+                        <input
+                          type="number"
+                          step="0.01"
+                          value={product.accessoryCost}
+                          onChange={(e) => updateProduct(product.id, "accessoryCost", Number(e.target.value))}
+                          className="w-full border border-gray-200 rounded px-2 py-1 text-black text-right"
+                        />
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2">
+                        <input
+                          type="number"
+                          step="0.01"
+                          value={product.stoneCost}
+                          onChange={(e) => updateProduct(product.id, "stoneCost", Number(e.target.value))}
+                          className="w-full border border-gray-200 rounded px-2 py-1 text-black text-right"
+                        />
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2">
+                        <input
+                          type="number"
+                          step="0.01"
+                          value={product.platingCost}
+                          onChange={(e) => updateProduct(product.id, "platingCost", Number(e.target.value))}
+                          className="w-full border border-gray-200 rounded px-2 py-1 text-black text-right"
+                        />
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2">
+                        <input
+                          type="text"
+                          value={product.supplierCode}
+                          onChange={(e) => updateProduct(product.id, "supplierCode", e.target.value)}
+                          className="w-full border border-gray-200 rounded px-2 py-1 text-black"
+                        />
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2 text-right font-bold text-blue-700">
+                        {product.retailPrice.toFixed(2)}
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2 text-right font-bold text-green-700">
+                        {product.wholesalePrice.toFixed(2)}
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2 text-right">
+                        {product.quantity || 0}
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2">
+                        <input
+                          type="text"
+                          value={product.remarks}
+                          onChange={(e) => updateProduct(product.id, "remarks", e.target.value)}
+                          className="w-full border border-gray-200 rounded px-2 py-1 text-black"
+                        />
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2 text-xs text-black">
+                        {formatDate(product.timestamp)}
+                      </td>
+                    </tr>
+                  ))}
+                  {products.filter(p => p.category === currentCategory).length === 0 && (
+                    <tr>
+                      <td colSpan={17} className="border border-gray-200 px-3 py-4 text-center text-black">
+                        æš‚æ— {currentCategory}äº§å“æ•°æ®
+                      </td>
+                    </tr>
+                  )}
+                </tbody>
+              </table>
+            </div>
+          </div>
+
+          {/* å†å²è®°å½• */}
+          <div className="bg-white rounded-lg shadow-md p-6 mb-6">
+            <h2 className="text-xl font-bold text-black mb-4">ä»·æ ¼å†å²è®°å½•</h2>
+            <div className="overflow-x-auto" style={{ maxHeight: '400px' }}>
+              <table className="w-full border-collapse border border-gray-200 text-sm">
+                <thead className="bg-gray-100 sticky top-0">
+                  <tr>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black">æ—¶é—´</th>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black">è´§å·</th>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black">åç§°</th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">å…‹é‡</th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">å·¥è´¹</th>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black">é“¶è‰²</th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">é›¶å”®ä»·</th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">æ‰¹å‘ä»·</th>
+                  </tr>
+                </thead>
+                <tbody>
+                  {priceHistory.filter(h => h.category === currentCategory).slice(0, 100).map(history => (
+                    <tr key={history.id}>
+                      <td className="border border-gray-200 px-3 py-2 whitespace-nowrap text-black text-xs">
+                        {formatDate(history.timestamp)}
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2 text-black">{history.productCode}</td>
+                      <td className="border border-gray-200 px-3 py-2 text-black">{history.productName}</td>
+                      <td className="border border-gray-200 px-3 py-2 text-right text-black">{history.weight}</td>
+                      <td className="border border-gray-200 px-3 py-2 text-right text-black">{history.laborCost}</td>
+                      <td className="border border-gray-200 px-3 py-2 text-black">{history.silverColor}</td>
+                      <td className="border border-gray-200 px-3 py-2 text-right text-black">{history.retailPrice.toFixed(2)}</td>
+                      <td className="border border-gray-200 px-3 py-2 text-right text-black">{history.wholesalePrice.toFixed(2)}</td>
+                    </tr>
+                  ))}
+                  {priceHistory.filter(h => h.category === currentCategory).length === 0 && (
+                    <tr>
+                      <td colSpan={8} className="border border-gray-200 px-3 py-4 text-center text-black">
+                        æš‚æ— å†å²è®°å½•
+                      </td>
+                    </tr>
+                  )}
+                </tbody>
+              </table>
+            </div>
+          </div>
+
           {/* è¿”å›é‡‘åˆ¶å“é¡µé¢ */}
           <div className="text-center">
             <button
-- 
2.43.0

From 36ed0253fc88c63ae7d9ce7a5bce60163e664f90 Mon Sep 17 00:00:00 2001
From: Marblee <3440803185179952-Marblee@noreply.coze.cn>
Date: Wed, 7 Jan 2026 12:19:54 +0800
Subject: [PATCH 04/13] =?UTF-8?q?fix(silver-quote):=20=E4=BF=AE=E5=A4=8D?=
 =?UTF-8?q?=E4=BA=A7=E5=93=81=E5=88=97=E8=A1=A8=E9=A2=9C=E8=89=B2=E5=88=97?=
 =?UTF-8?q?=E6=98=BE=E7=A4=BA=E3=80=81=E4=BC=98=E5=8C=96=E4=BA=91=E7=AB=AF?=
 =?UTF-8?q?=E5=90=8C=E6=AD=A5UI=E3=80=81=E6=B7=BB=E5=8A=A0=E6=89=B9?=
 =?UTF-8?q?=E9=87=8F=E6=93=8D=E4=BD=9C=E5=8A=9F=E8=83=BD?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

- ä¿®å¤é“¶è‰²åˆ—æ˜¾ç¤ºé—®é¢˜ï¼šæ·»åŠ æœ€å°å®½åº¦min-w-[160px]ï¼Œç¡®ä¿é“¶è‰²/é•€é‡‘/é•€ç«ç‘°é‡‘å®Œæ•´æ˜¾ç¤º
- é‡æ„äº‘ç«¯åŒæ­¥èœå•UIï¼šç¾åŒ–ç•Œé¢ï¼Œæ·»åŠ æ¸å˜å¤´éƒ¨ï¼Œæ¸…æ™°æ˜¾ç¤ºä¸Šä¼ /åˆå¹¶ä¸‹è½½/è¦†ç›–ä¸‹è½½/åŒæ­¥çŠ¶æ€
- æ–°å¢æ‰¹é‡æ“ä½œåŠŸèƒ½ï¼šæ·»åŠ å…¨é€‰å¤é€‰æ¡†ã€æ‰¹é‡é€‰æ‹©ã€æ‰¹é‡åˆ é™¤ã€æ‰¹é‡ç¼–è¾‘å·¥è´¹
- æ–°å¢æ•°æ®ç®¡ç†æŒ‰é’®ï¼šéªŒè¯æ•°æ®åŠŸèƒ½æ£€æŸ¥æ•°æ®å®Œæ•´æ€§ï¼ŒåŒæ­¥æ•°æ®æŒ‰é’®å¿«é€Ÿæ‰“å¼€äº‘åŒæ­¥
- æ‰€æœ‰ä¿®æ”¹é€šè¿‡TypeScriptç±»å‹æ£€æŸ¥ï¼ŒæœåŠ¡æ­£å¸¸è¿è¡Œ
---
 src/app/silver-quote/page.tsx | 275 ++++++++++++++++++++++++++++------
 1 file changed, 227 insertions(+), 48 deletions(-)

diff --git a/src/app/silver-quote/page.tsx b/src/app/silver-quote/page.tsx
index 4c5eb01..b203da2 100644
--- a/src/app/silver-quote/page.tsx
+++ b/src/app/silver-quote/page.tsx
@@ -447,6 +447,75 @@ function SilverQuotePage() {
   const [currentCategory, setCurrentCategory] = useState<SilverProductCategory>("é…ä»¶");
   const [currentSubCategory, setCurrentSubCategory] = useState<string | null>(null);
 
+  // æ‰¹é‡æ“ä½œçŠ¶æ€
+  const [selectedProductIds, setSelectedProductIds] = useState<Set<string>>(new Set());
+
+  // æ‰¹é‡é€‰æ‹©æ“ä½œ
+  const toggleSelectAll = (checked: boolean) => {
+    const filtered = products.filter(p => {
+      if (p.category !== currentCategory) return false;
+      if (currentSubCategory && p.subCategory !== currentSubCategory) return false;
+      return true;
+    });
+    setSelectedProductIds(checked ? new Set(filtered.map(p => p.id)) : new Set());
+  };
+
+  const toggleSelectProduct = (id: string) => {
+    const newSelected = new Set(selectedProductIds);
+    if (newSelected.has(id)) {
+      newSelected.delete(id);
+    } else {
+      newSelected.add(id);
+    }
+    setSelectedProductIds(newSelected);
+  };
+
+  // æ‰¹é‡åˆ é™¤
+  const batchDelete = () => {
+    if (selectedProductIds.size === 0) {
+      alert("è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„äº§å“");
+      return;
+    }
+    if (window.confirm(`ç¡®è®¤åˆ é™¤é€‰ä¸­çš„ ${selectedProductIds.size} ä¸ªäº§å“ï¼Ÿ`)) {
+      const newProducts = products.filter(p => !selectedProductIds.has(p.id));
+      const newHistory = priceHistory.filter(h => !selectedProductIds.has(h.productId));
+      setProducts(newProducts);
+      setPriceHistory(newHistory);
+      saveToLocalStorage(newProducts, newHistory);
+      setSelectedProductIds(new Set());
+    }
+  };
+
+  // æ‰¹é‡ç¼–è¾‘ - ä¿®æ”¹å·¥è´¹
+  const batchEditLaborCost = () => {
+    if (selectedProductIds.size === 0) {
+      alert("è¯·å…ˆé€‰æ‹©è¦ç¼–è¾‘çš„äº§å“");
+      return;
+    }
+    const newLaborCost = prompt(`è¯·è¾“å…¥æ–°çš„å·¥è´¹å€¼ï¼ˆå°†åº”ç”¨äº ${selectedProductIds.size} ä¸ªäº§å“ï¼‰:`);
+    if (newLaborCost === null || newLaborCost.trim() === "") return;
+
+    const laborCostNum = Number(newLaborCost);
+    if (isNaN(laborCostNum)) {
+      alert("è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—");
+      return;
+    }
+
+    const updatedProducts = products.map(p => {
+      if (selectedProductIds.has(p.id)) {
+        const updated = { ...p, laborCost: laborCostNum };
+        updated.retailPrice = calculateSilverPrice(updated, true);
+        updated.wholesalePrice = calculateSilverPrice(updated, false);
+        return updated;
+      }
+      return p;
+    });
+
+    setProducts(updatedProducts);
+    saveToLocalStorage(updatedProducts);
+    alert(`å·²æ›´æ–° ${selectedProductIds.size} ä¸ªäº§å“çš„å·¥è´¹`);
+  };
+
   // æ·»åŠ äº§å“
   const addProduct = () => {
     const newProduct: SilverProduct = {
@@ -836,6 +905,29 @@ function SilverQuotePage() {
     reader.readAsBinaryString(file);
   };
 
+  // éªŒè¯æ•°æ®
+  const validateData = () => {
+    const errors: string[] = [];
+
+    products.forEach(p => {
+      if (!p.productName) {
+        errors.push(`è´§å· ${p.productCode || "æœªå¡«å†™"}ï¼šäº§å“åç§°ä¸ºç©º`);
+      }
+      if (p.weight <= 0) {
+        errors.push(`è´§å· ${p.productCode || "æœªå¡«å†™"}ï¼šå…‹é‡å¿…é¡»å¤§äº0`);
+      }
+      if (!p.productCode) {
+        errors.push(`äº§å“ ${p.productName || "æœªå¡«å†™"}ï¼šè´§å·ä¸ºç©º`);
+      }
+    });
+
+    if (errors.length === 0) {
+      alert(`âœ“ æ•°æ®éªŒè¯é€šè¿‡ï¼å…± ${products.length} ä¸ªäº§å“`);
+    } else {
+      alert(`âœ— å‘ç° ${errors.length} ä¸ªé—®é¢˜ï¼š\n\n${errors.slice(0, 10).join("\n")}${errors.length > 10 ? `\n...è¿˜æœ‰ ${errors.length - 10} ä¸ªé—®é¢˜` : ""}`);
+    }
+  };
+
   // ========== é¡µé¢UI ==========
 
   return (
@@ -854,61 +946,83 @@ function SilverQuotePage() {
                   setShowSyncMenu(!showSyncMenu);
                   checkCloudData();
                 }}
-                className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 flex items-center gap-2"
+                className="bg-blue-600 text-white px-5 py-2.5 rounded-lg hover:bg-blue-700 flex items-center gap-2 shadow-md transition-all"
               >
-                <span>â˜ï¸</span>
-                <span>äº‘ç«¯åŒæ­¥</span>
+                <span className="text-lg">â˜ï¸</span>
+                <span className="font-medium">äº‘ç«¯åŒæ­¥</span>
               </button>
 
               {/* äº‘ç«¯åŒæ­¥èœå• */}
               {showSyncMenu && (
-                <div className="absolute right-0 mt-2 w-72 bg-white rounded-lg shadow-lg border border-gray-200 z-50">
-                  <div className="py-3">
-                    <div className="px-4 pb-2 border-b border-gray-200">
-                      <div className="text-sm font-semibold text-black">äº‘ç«¯æ•°æ®åŒæ­¥</div>
-                      {cloudDataExists && (
-                        <div className="text-xs text-green-600 mt-1">âœ“ äº‘ç«¯å·²æœ‰æ•°æ®</div>
-                      )}
+                <div className="absolute right-0 mt-3 w-80 bg-white rounded-xl shadow-2xl border border-gray-200 z-50 overflow-hidden">
+                  {/* èœå•å¤´éƒ¨ - å§‹ç»ˆæ˜¾ç¤ºåŒæ­¥çŠ¶æ€ */}
+                  <div className="bg-gradient-to-r from-blue-500 to-blue-600 px-5 py-4">
+                    <div className="text-white font-bold text-lg mb-1">äº‘ç«¯æ•°æ®åŒæ­¥</div>
+                    <div className="flex items-center gap-2">
+                      <span className={`text-sm font-medium ${cloudDataExists ? "text-green-200" : "text-yellow-200"}`}>
+                        {cloudDataExists ? "â— äº‘ç«¯å·²æœ‰æ•°æ®" : "â—‹ äº‘ç«¯æš‚æ— æ•°æ®"}
+                      </span>
                     </div>
-
-                    {/* åŒæ­¥çŠ¶æ€æ¶ˆæ¯ */}
                     {syncStatus !== "idle" && (
-                      <div className="px-4 py-2">
-                        <div className={`text-sm ${syncStatus === "error" ? "text-red-600" : syncStatus === "success" ? "text-green-600" : "text-blue-600"}`}>
-                          {syncMessage}
-                        </div>
+                      <div className="mt-2 text-sm text-white bg-white/20 rounded px-3 py-2">
+                        {syncStatus === "syncing" && "â³ "}{syncStatus === "error" && "âŒ "}{syncStatus === "success" && "âœ… "}
+                        {syncMessage}
                       </div>
                     )}
+                  </div>
 
-                    <div className="px-4 py-2 space-y-1">
-                      <button
-                        onClick={uploadToCloud}
-                        disabled={syncStatus === "syncing"}
-                        className="w-full text-left px-3 py-2 rounded hover:bg-blue-50 text-black text-sm disabled:opacity-50"
-                      >
-                        ğŸ“¤ ä¸Šä¼ åˆ°äº‘ç«¯
-                      </button>
-                      <button
-                        onClick={() => downloadFromCloud("merge")}
-                        disabled={syncStatus === "syncing"}
-                        className="w-full text-left px-3 py-2 rounded hover:bg-green-50 text-black text-sm disabled:opacity-50"
-                      >
-                        ğŸ“¥ åˆå¹¶ä¸‹è½½ï¼ˆä¿ç•™æœ¬åœ°ï¼‰
-                      </button>
-                      <button
-                        onClick={() => downloadFromCloud("replace")}
-                        disabled={syncStatus === "syncing"}
-                        className="w-full text-left px-3 py-2 rounded hover:bg-orange-50 text-black text-sm disabled:opacity-50"
-                      >
-                        ğŸ”„ è¦†ç›–ä¸‹è½½ï¼ˆæ›¿æ¢æœ¬åœ°ï¼‰
-                      </button>
-                    </div>
+                  {/* æ“ä½œæŒ‰é’®åŒº */}
+                  <div className="p-4 space-y-2">
+                    <button
+                      onClick={uploadToCloud}
+                      disabled={syncStatus === "syncing"}
+                      className="w-full flex items-center justify-between px-4 py-3 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed border border-blue-200"
+                    >
+                      <div className="flex items-center gap-3">
+                        <span className="text-xl">ğŸ“¤</span>
+                        <div className="text-left">
+                          <div className="font-semibold">ä¸Šä¼ åˆ°äº‘ç«¯</div>
+                          <div className="text-xs text-blue-600">å°†æœ¬åœ°æ•°æ®ä¸Šä¼ åˆ°æœåŠ¡å™¨</div>
+                        </div>
+                      </div>
+                      <span className="text-blue-400">â†’</span>
+                    </button>
 
-                    <div className="px-4 pt-2 border-t border-gray-200">
-                      <div className="text-xs text-gray-500">
-                        ä¸Šä¼ åŒ…å«ï¼šäº§å“æ•°æ®ã€å†å²è®°å½•ã€é“¶ä»·è®¾ç½®ã€ä»·æ ¼ç³»æ•°
+                    <button
+                      onClick={() => downloadFromCloud("merge")}
+                      disabled={syncStatus === "syncing"}
+                      className="w-full flex items-center justify-between px-4 py-3 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed border border-green-200"
+                    >
+                      <div className="flex items-center gap-3">
+                        <span className="text-xl">ğŸ“¥</span>
+                        <div className="text-left">
+                          <div className="font-semibold">åˆå¹¶ä¸‹è½½</div>
+                          <div className="text-xs text-green-600">ä¿ç•™æœ¬åœ°æ•°æ®ï¼Œæ·»åŠ äº‘ç«¯æ•°æ®</div>
+                        </div>
                       </div>
-                    </div>
+                      <span className="text-green-400">â†’</span>
+                    </button>
+
+                    <button
+                      onClick={() => downloadFromCloud("replace")}
+                      disabled={syncStatus === "syncing"}
+                      className="w-full flex items-center justify-between px-4 py-3 bg-orange-50 hover:bg-orange-100 text-orange-700 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed border border-orange-200"
+                    >
+                      <div className="flex items-center gap-3">
+                        <span className="text-xl">ğŸ”„</span>
+                        <div className="text-left">
+                          <div className="font-semibold">è¦†ç›–ä¸‹è½½</div>
+                          <div className="text-xs text-orange-600">å®Œå…¨æ›¿æ¢æœ¬åœ°æ•°æ®</div>
+                        </div>
+                      </div>
+                      <span className="text-orange-400">â†’</span>
+                    </button>
+                  </div>
+
+                  {/* åº•éƒ¨è¯´æ˜ */}
+                  <div className="px-5 py-3 bg-gray-50 border-t border-gray-200">
+                    <div className="text-xs text-gray-600 font-medium mb-1">åŒæ­¥å†…å®¹åŒ…å«:</div>
+                    <div className="text-xs text-gray-500">äº§å“æ•°æ®ã€å†å²è®°å½•ã€é“¶ä»·è®¾ç½®ã€ä»·æ ¼ç³»æ•°</div>
                   </div>
                 </div>
               )}
@@ -1126,14 +1240,52 @@ function SilverQuotePage() {
           {/* äº§å“æ“ä½œåŒº */}
           <div className="bg-white rounded-lg shadow-md p-6 mb-6">
             <div className="flex items-center justify-between mb-4">
-              <h2 className="text-xl font-bold text-black">äº§å“ç®¡ç†</h2>
-              <div className="flex gap-2">
+              <div>
+                <h2 className="text-xl font-bold text-black">äº§å“ç®¡ç†</h2>
+                {selectedProductIds.size > 0 && (
+                  <div className="text-sm text-blue-600 mt-1">
+                    å·²é€‰æ‹© {selectedProductIds.size} ä¸ªäº§å“
+                  </div>
+                )}
+              </div>
+              <div className="flex gap-2 flex-wrap">
                 <button
                   onClick={addProduct}
                   className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
                 >
                   æ·»åŠ äº§å“
                 </button>
+                {selectedProductIds.size > 0 && (
+                  <>
+                    <button
+                      onClick={batchEditLaborCost}
+                      className="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600"
+                    >
+                      æ‰¹é‡ä¿®æ”¹å·¥è´¹
+                    </button>
+                    <button
+                      onClick={batchDelete}
+                      className="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600"
+                    >
+                      æ‰¹é‡åˆ é™¤
+                    </button>
+                  </>
+                )}
+                <button
+                  onClick={validateData}
+                  className="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600"
+                >
+                  éªŒè¯æ•°æ®
+                </button>
+                <button
+                  onClick={() => {
+                    setShowSyncMenu(!showSyncMenu);
+                    checkCloudData();
+                  }}
+                  className="bg-cyan-500 text-white px-4 py-2 rounded hover:bg-cyan-600"
+                >
+                  åŒæ­¥æ•°æ®
+                </button>
                 <button
                   onClick={exportToExcel}
                   className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600"
@@ -1198,13 +1350,32 @@ function SilverQuotePage() {
               <table className="w-full border-collapse border border-gray-200 text-sm">
                 <thead className="bg-gray-100">
                   <tr>
+                    <th className="border border-gray-200 px-3 py-2 text-center w-12">
+                      <input
+                        type="checkbox"
+                        checked={
+                          products.filter(p => {
+                            if (p.category !== currentCategory) return false;
+                            if (currentSubCategory && p.subCategory !== currentSubCategory) return false;
+                            return true;
+                          }).length > 0 &&
+                          products.filter(p => {
+                            if (p.category !== currentCategory) return false;
+                            if (currentSubCategory && p.subCategory !== currentSubCategory) return false;
+                            return true;
+                          }).every(p => selectedProductIds.has(p.id))
+                        }
+                        onChange={(e) => toggleSelectAll(e.target.checked)}
+                        className="w-4 h-4"
+                      />
+                    </th>
                     <th className="border border-gray-200 px-3 py-2 text-left text-black">æ“ä½œ</th>
                     <th className="border border-gray-200 px-3 py-2 text-left text-black">è´§å·</th>
                     <th className="border border-gray-200 px-3 py-2 text-left text-black">äº§å“åç§°</th>
                     <th className="border border-gray-200 px-3 py-2 text-left text-black">è§„æ ¼</th>
                     <th className="border border-gray-200 px-3 py-2 text-right text-black">å…‹é‡</th>
                     <th className="border border-gray-200 px-3 py-2 text-right text-black">å·¥è´¹</th>
-                    <th className="border border-gray-200 px-3 py-2 text-left text-black">é“¶è‰²</th>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black min-w-[160px]">é“¶è‰²</th>
                     <th className="border border-gray-200 px-3 py-2 text-right text-black">é…ä»¶æˆæœ¬</th>
                     <th className="border border-gray-200 px-3 py-2 text-right text-black">çŸ³å¤´æˆæœ¬</th>
                     <th className="border border-gray-200 px-3 py-2 text-right text-black">ç”µé•€æˆæœ¬</th>
@@ -1223,6 +1394,14 @@ function SilverQuotePage() {
                     return true;
                   }).map(product => (
                     <tr key={product.id}>
+                      <td className="border border-gray-200 px-3 py-2 text-center">
+                        <input
+                          type="checkbox"
+                          checked={selectedProductIds.has(product.id)}
+                          onChange={() => toggleSelectProduct(product.id)}
+                          className="w-4 h-4"
+                        />
+                      </td>
                       <td className="border border-gray-200 px-3 py-2">
                         <button
                           onClick={() => deleteProduct(product.id)}
@@ -1273,7 +1452,7 @@ function SilverQuotePage() {
                           className="w-full border border-gray-200 rounded px-2 py-1 text-black text-right"
                         />
                       </td>
-                      <td className="border border-gray-200 px-3 py-2">
+                      <td className="border border-gray-200 px-3 py-2 min-w-[160px]">
                         <select
                           value={product.silverColor}
                           onChange={(e) => updateProduct(product.id, "silverColor", e.target.value as any)}
@@ -1344,7 +1523,7 @@ function SilverQuotePage() {
                   ))}
                   {products.filter(p => p.category === currentCategory).length === 0 && (
                     <tr>
-                      <td colSpan={17} className="border border-gray-200 px-3 py-4 text-center text-black">
+                      <td colSpan={18} className="border border-gray-200 px-3 py-4 text-center text-black">
                         æš‚æ— {currentCategory}äº§å“æ•°æ®
                       </td>
                     </tr>
-- 
2.43.0

From e274abbb6efa6fce0c54ad852a8c744c79adc130 Mon Sep 17 00:00:00 2001
From: Marblee <3440803185179952-Marblee@noreply.coze.cn>
Date: Wed, 7 Jan 2026 12:22:01 +0800
Subject: [PATCH 05/13] =?UTF-8?q?feat(silver-quote):=20=E4=BC=98=E5=8C=96E?=
 =?UTF-8?q?xcel=E5=AF=BC=E5=85=A5=E5=8A=9F=E8=83=BD=EF=BC=8C=E6=94=AF?=
 =?UTF-8?q?=E6=8C=81=E5=88=86=E7=B1=BB=E9=80=89=E6=8B=A9=E5=AF=BC=E5=85=A5?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

- å¯¼å…¥æ—¶è‡ªåŠ¨æ£€æµ‹Excelä¸­åŒ…å«çš„äº§å“åˆ†ç±»
- å½“ExcelåŒ…å«å¤šä¸ªåˆ†ç±»æ—¶ï¼Œå¼¹å‡ºç¡®è®¤æ¡†è®©ç”¨æˆ·é€‰æ‹©å¯¼å…¥æ–¹å¼
- æ”¯æŒå¯¼å…¥æ‰€æœ‰åˆ†ç±»æˆ–ä»…å¯¼å…¥å½“å‰åˆ†ç±»ä¸¤ç§æ¨¡å¼
- å¯¼å…¥å®Œæˆåæ˜¾ç¤ºè¯¦ç»†çš„åˆ†ç±»ç»Ÿè®¡ä¿¡æ¯
- æå‡ç”¨æˆ·ä½“éªŒï¼Œé¿å…æ„å¤–å¯¼å…¥ä¸éœ€è¦çš„åˆ†ç±»æ•°æ®
---
 src/app/silver-quote/page.tsx | 104 ++++++++++++++++++++++++----------
 1 file changed, 73 insertions(+), 31 deletions(-)

diff --git a/src/app/silver-quote/page.tsx b/src/app/silver-quote/page.tsx
index b203da2..d2f463e 100644
--- a/src/app/silver-quote/page.tsx
+++ b/src/app/silver-quote/page.tsx
@@ -860,36 +860,67 @@ function SilverQuotePage() {
       const sheet = workbook.Sheets[sheetName];
       const jsonData = XLSX.utils.sheet_to_json(sheet);
 
-      const importedProducts: SilverProduct[] = jsonData.map((row: any, index) => ({
-        id: Date.now().toString() + index,
-        category: row["åˆ†ç±»"] || row["åˆ†ç±»"] || currentCategory,
-        subCategory: row["å­åˆ†ç±»"] || row["å­åˆ†ç±»"] || SILVER_SUB_CATEGORIES[currentCategory][0],
-        productCode: row["è´§å·"] || "",
-        productName: row["äº§å“åç§°"] || "",
-        specification: row["è§„æ ¼"] || "",
-        weight: Number(row["å…‹é‡"]) || 0,
-        laborCost: Number(row["å·¥è´¹"]) || 0,
-        silverColor: row["é“¶è‰²"] || "é“¶è‰²",
-        silverPrice: silverPrice,
-        wholesalePrice: 0,
-        retailPrice: 0,
-        accessoryCost: Number(row["é…ä»¶æˆæœ¬"]) || 0,
-        stoneCost: Number(row["çŸ³å¤´æˆæœ¬"]) || 0,
-        platingCost: Number(row["ç”µé•€æˆæœ¬"]) || 0,
-        moldCost: 0,
-        commission: 0,
-        supplierCode: row["ä¾›åº”å•†ä»£ç "] || "E1",
-        remarks: row["å¤‡æ³¨"] || "",
-        quantity: Number(row["ç´¯è®¡æ•°é‡"]) || 0,
-        quantityDate: "",
-        laborCostDate: "",
-        accessoryCostDate: "",
-        stoneCostDate: "",
-        platingCostDate: "",
-        moldCostDate: "",
-        commissionDate: "",
-        timestamp: new Date().toISOString(),
-      }));
+      // æ£€æŸ¥Excelä¸­æ˜¯å¦åŒ…å«"åˆ†ç±»"åˆ—
+      const hasCategoryColumn = jsonData.length > 0 && (jsonData[0] as any)["åˆ†ç±»"] !== undefined;
+      const categoriesInFile = hasCategoryColumn
+        ? [...new Set(jsonData.map((row: any) => row["åˆ†ç±»"]).filter(cat => cat))]
+        : [];
+
+      // ç¡®è®¤å¯¼å…¥æ–¹å¼
+      let importMode: "all" | "current" = "all";
+
+      if (hasCategoryColumn && categoriesInFile.length > 0) {
+        // Excelä¸­æœ‰åˆ†ç±»åˆ—ï¼Œè¯¢é—®ç”¨æˆ·å¯¼å…¥æ¨¡å¼
+        const message = `æ£€æµ‹åˆ°Excelæ–‡ä»¶åŒ…å«ä»¥ä¸‹åˆ†ç±»ï¼š\n${categoriesInFile.join(", ")}\n\nè¯·é€‰æ‹©å¯¼å…¥æ–¹å¼ï¼š\nâ€¢ ç‚¹å‡»"ç¡®å®š"ï¼šå¯¼å…¥æ‰€æœ‰åˆ†ç±»çš„äº§å“\nâ€¢ ç‚¹å‡»"å–æ¶ˆ"ï¼šä»…å¯¼å…¥å½“å‰é€‰ä¸­åˆ†ç±»ï¼ˆ${currentCategory}ï¼‰çš„äº§å“`;
+        importMode = window.confirm(message) ? "all" : "current";
+      }
+
+      // å¯¼å…¥äº§å“
+      const importedProducts: SilverProduct[] = jsonData
+        .filter((row: any) => {
+          // å¦‚æœé€‰æ‹©äº†"ä»…å¯¼å…¥å½“å‰åˆ†ç±»"ï¼Œåˆ™è¿‡æ»¤
+          if (importMode === "current") {
+            const rowCategory = row["åˆ†ç±»"];
+            if (!rowCategory) return false; // æ²¡æœ‰åˆ†ç±»çš„ä¹Ÿä¸å¯¼å…¥
+            return rowCategory === currentCategory;
+          }
+          return true;
+        })
+        .map((row: any, index) => ({
+          id: Date.now().toString() + index,
+          category: row["åˆ†ç±»"] || currentCategory,
+          subCategory: row["å­åˆ†ç±»"] || SILVER_SUB_CATEGORIES[(row["åˆ†ç±»"] as SilverProductCategory) || currentCategory]?.[0] || "",
+          productCode: row["è´§å·"] || "",
+          productName: row["äº§å“åç§°"] || "",
+          specification: row["è§„æ ¼"] || "",
+          weight: Number(row["å…‹é‡"]) || 0,
+          laborCost: Number(row["å·¥è´¹"]) || 0,
+          silverColor: row["é“¶è‰²"] || "é“¶è‰²",
+          silverPrice: silverPrice,
+          wholesalePrice: 0,
+          retailPrice: 0,
+          accessoryCost: Number(row["é…ä»¶æˆæœ¬"]) || 0,
+          stoneCost: Number(row["çŸ³å¤´æˆæœ¬"]) || 0,
+          platingCost: Number(row["ç”µé•€æˆæœ¬"]) || 0,
+          moldCost: 0,
+          commission: 0,
+          supplierCode: row["ä¾›åº”å•†ä»£ç "] || "E1",
+          remarks: row["å¤‡æ³¨"] || "",
+          quantity: Number(row["ç´¯è®¡æ•°é‡"]) || 0,
+          quantityDate: "",
+          laborCostDate: "",
+          accessoryCostDate: "",
+          stoneCostDate: "",
+          platingCostDate: "",
+          moldCostDate: "",
+          commissionDate: "",
+          timestamp: new Date().toISOString(),
+        }));
+
+      if (importedProducts.length === 0) {
+        alert("æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆå¯¼å…¥æ¡ä»¶çš„äº§å“");
+        return;
+      }
 
       // è®¡ç®—ä»·æ ¼
       const withPrices = importedProducts.map(p => ({
@@ -900,7 +931,18 @@ function SilverQuotePage() {
 
       setProducts([...products, ...withPrices]);
       saveToLocalStorage([...products, ...withPrices]);
-      alert(`æˆåŠŸå¯¼å…¥ ${importedProducts.length} ä¸ªäº§å“`);
+
+      // æ˜¾ç¤ºå¯¼å…¥è¯¦æƒ…
+      const categoryCount = importedProducts.reduce((acc, p) => {
+        acc[p.category] = (acc[p.category] || 0) + 1;
+        return acc;
+      }, {} as Record<string, number>);
+
+      const details = Object.entries(categoryCount)
+        .map(([cat, count]) => `${cat}: ${count}ä¸ª`)
+        .join("\n");
+
+      alert(`âœ“ æˆåŠŸå¯¼å…¥ ${importedProducts.length} ä¸ªäº§å“\n\nå¯¼å…¥è¯¦æƒ…ï¼š\n${details}`);
     };
     reader.readAsBinaryString(file);
   };
-- 
2.43.0

From 345ffa7d0c742a38aed0b27912c98d7ec116d175 Mon Sep 17 00:00:00 2001
From: Marblee <3440803185179952-Marblee@noreply.coze.cn>
Date: Wed, 7 Jan 2026 12:24:47 +0800
Subject: [PATCH 06/13] =?UTF-8?q?feat(silver-quote):=20=E6=B7=BB=E5=8A=A0?=
 =?UTF-8?q?=E4=BA=A7=E5=93=81=E5=90=8C=E6=AD=A5=E7=8A=B6=E6=80=81=E6=98=BE?=
 =?UTF-8?q?=E7=A4=BA=E5=8A=9F=E8=83=BD?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

- åœ¨äº§å“æ•°æ®ç»“æ„ä¸­æ·»åŠ syncStatuså­—æ®µï¼ˆsynced/unsyncedï¼‰
- äº§å“åˆ—è¡¨æ–°å¢åŒæ­¥çŠ¶æ€åˆ—ï¼Œæ˜¾ç¤ºå›¾æ ‡ï¼š
  - âœ“ ç»¿è‰²åœ†ç‚¹è¡¨ç¤ºå·²åŒæ­¥
  - ! é»„è‰²åœ†ç‚¹è¡¨ç¤ºæœªåŒæ­¥
- æ·»åŠ äº§å“æ—¶è‡ªåŠ¨æ ‡è®°ä¸ºæœªåŒæ­¥
- ç¼–è¾‘äº§å“æ—¶è‡ªåŠ¨æ ‡è®°ä¸ºæœªåŒæ­¥
- Excelå¯¼å…¥äº§å“æ—¶è‡ªåŠ¨æ ‡è®°ä¸ºæœªåŒæ­¥
- ä¸Šä¼ åˆ°äº‘ç«¯æˆåŠŸåæ ‡è®°æ‰€æœ‰äº§å“ä¸ºå·²åŒæ­¥
- ä»äº‘ç«¯ä¸‹è½½åæ ‡è®°æ‰€æœ‰äº§å“ä¸ºå·²åŒæ­¥
- å…¼å®¹æ—§æ•°æ®ï¼Œè‡ªåŠ¨ä¸ºæ²¡æœ‰syncStatusçš„äº§å“æ·»åŠ é»˜è®¤å€¼
---
 src/app/silver-quote/page.tsx | 47 +++++++++++++++++++++++++++++++----
 1 file changed, 42 insertions(+), 5 deletions(-)

diff --git a/src/app/silver-quote/page.tsx b/src/app/silver-quote/page.tsx
index d2f463e..f12c1df 100644
--- a/src/app/silver-quote/page.tsx
+++ b/src/app/silver-quote/page.tsx
@@ -237,6 +237,7 @@ interface SilverProduct {
   moldCostDate: string;
   commissionDate: string;
   timestamp: string;
+  syncStatus: "synced" | "unsynced";  // åŒæ­¥çŠ¶æ€ï¼šå·²åŒæ­¥/æœªåŒæ­¥
 }
 
 interface SilverPriceHistory {
@@ -547,6 +548,7 @@ function SilverQuotePage() {
       moldCostDate: "",
       commissionDate: "",
       timestamp: new Date().toISOString(),
+      syncStatus: "unsynced",
     };
 
     setProducts([...products, newProduct]);
@@ -580,6 +582,9 @@ function SilverQuotePage() {
         updated.retailPrice = calculateSilverPrice(updated, true);
         updated.wholesalePrice = calculateSilverPrice(updated, false);
 
+        // ä¿®æ”¹äº§å“åæ ‡è®°ä¸ºæœªåŒæ­¥
+        updated.syncStatus = "unsynced";
+
         return updated;
       }
       return p;
@@ -707,6 +712,11 @@ function SilverQuotePage() {
       });
 
       if (response.ok) {
+        // ä¸Šä¼ æˆåŠŸåï¼Œæ ‡è®°æ‰€æœ‰äº§å“ä¸ºå·²åŒæ­¥
+        const syncedProducts = products.map(p => ({ ...p, syncStatus: "synced" as const }));
+        setProducts(syncedProducts);
+        saveToLocalStorage(syncedProducts);
+
         setSyncStatus("success");
         setSyncMessage("æ•°æ®ä¸Šä¼ æˆåŠŸï¼");
         setCloudDataExists(true);
@@ -749,16 +759,23 @@ function SilverQuotePage() {
         const data = await response.json();
 
         if (mode === "replace") {
-          setProducts(data.products || []);
+          // è¦†ç›–æ¨¡å¼ï¼šæ ‡è®°æ‰€æœ‰äº§å“ä¸ºå·²åŒæ­¥
+          const syncedProducts = (data.products || []).map((p: SilverProduct) => ({ ...p, syncStatus: "synced" as const }));
+          setProducts(syncedProducts);
           setPriceHistory(data.history || []);
           setSilverPrice(data.silverPrice || 20);
           setSilverCoefficients(data.coefficients || silverCoefficients);
+          saveToLocalStorage(syncedProducts, data.history || []);
         } else {
           // åˆå¹¶æ¨¡å¼ï¼šä¿ç•™æœ¬åœ°æ•°æ®ï¼Œæ·»åŠ äº‘ç«¯ä¸å­˜åœ¨çš„æ•°æ®
           const existingIds = new Set(products.map(p => p.id));
-          const newProducts = (data.products || []).filter((p: SilverProduct) => !existingIds.has(p.id));
-          setProducts([...products, ...newProducts]);
+          const newProducts = (data.products || [])
+            .filter((p: SilverProduct) => !existingIds.has(p.id))
+            .map((p: SilverProduct) => ({ ...p, syncStatus: "synced" as const }));
+          const mergedProducts = [...products, ...newProducts];
+          setProducts(mergedProducts);
           setPriceHistory([...priceHistory, ...(data.history || [])]);
+          saveToLocalStorage(mergedProducts, [...priceHistory, ...(data.history || [])]);
         }
 
         setSyncStatus("success");
@@ -790,7 +807,13 @@ function SilverQuotePage() {
       const savedHistory = localStorage.getItem("silverPriceHistory");
 
       if (savedProducts) {
-        setProducts(JSON.parse(savedProducts));
+        // å…¼å®¹æ—§æ•°æ®ï¼Œä¸ºæ²¡æœ‰ syncStatus çš„äº§å“æ·»åŠ é»˜è®¤å€¼
+        const loadedProducts: SilverProduct[] = JSON.parse(savedProducts);
+        const productsWithSyncStatus = loadedProducts.map(p => ({
+          ...p,
+          syncStatus: p.syncStatus || "unsynced"
+        }));
+        setProducts(productsWithSyncStatus);
       }
       if (savedHistory) {
         setPriceHistory(JSON.parse(savedHistory));
@@ -915,6 +938,7 @@ function SilverQuotePage() {
           moldCostDate: "",
           commissionDate: "",
           timestamp: new Date().toISOString(),
+          syncStatus: "unsynced",
         }));
 
       if (importedProducts.length === 0) {
@@ -1266,6 +1290,7 @@ function SilverQuotePage() {
                   moldCostDate: "",
                   commissionDate: "",
                   timestamp: new Date().toISOString(),
+                  syncStatus: "unsynced",
                 };
 
                 const retail = calculateSilverPrice(testProduct, true);
@@ -1411,6 +1436,7 @@ function SilverQuotePage() {
                         className="w-4 h-4"
                       />
                     </th>
+                    <th className="border border-gray-200 px-3 py-2 text-center text-black w-16">åŒæ­¥</th>
                     <th className="border border-gray-200 px-3 py-2 text-left text-black">æ“ä½œ</th>
                     <th className="border border-gray-200 px-3 py-2 text-left text-black">è´§å·</th>
                     <th className="border border-gray-200 px-3 py-2 text-left text-black">äº§å“åç§°</th>
@@ -1444,6 +1470,17 @@ function SilverQuotePage() {
                           className="w-4 h-4"
                         />
                       </td>
+                      <td className="border border-gray-200 px-3 py-2 text-center">
+                        {product.syncStatus === "synced" ? (
+                          <span className="inline-flex items-center justify-center w-6 h-6 bg-green-100 text-green-600 rounded-full" title="å·²åŒæ­¥">
+                            âœ“
+                          </span>
+                        ) : (
+                          <span className="inline-flex items-center justify-center w-6 h-6 bg-yellow-100 text-yellow-600 rounded-full" title="æœªåŒæ­¥">
+                            !
+                          </span>
+                        )}
+                      </td>
                       <td className="border border-gray-200 px-3 py-2">
                         <button
                           onClick={() => deleteProduct(product.id)}
@@ -1565,7 +1602,7 @@ function SilverQuotePage() {
                   ))}
                   {products.filter(p => p.category === currentCategory).length === 0 && (
                     <tr>
-                      <td colSpan={18} className="border border-gray-200 px-3 py-4 text-center text-black">
+                      <td colSpan={19} className="border border-gray-200 px-3 py-4 text-center text-black">
                         æš‚æ— {currentCategory}äº§å“æ•°æ®
                       </td>
                     </tr>
-- 
2.43.0

From f5456e959296dd7f33726644c1298a650fc6c455 Mon Sep 17 00:00:00 2001
From: Marblee <3440803185179952-Marblee@noreply.coze.cn>
Date: Wed, 7 Jan 2026 12:42:16 +0800
Subject: [PATCH 07/13] =?UTF-8?q?feat(silver-quote):=20=E6=9B=B4=E6=96=B0?=
 =?UTF-8?q?=E9=93=B6=E5=88=B6=E5=93=81=E5=88=86=E7=B1=BB=E7=BB=93=E6=9E=84?=
 =?UTF-8?q?=EF=BC=8C=E6=B7=BB=E5=8A=A0=E5=85=B6=E5=AE=83=E5=A4=A7=E7=B1=BB?=
 =?UTF-8?q?=E5=8F=8A=E5=AE=8C=E6=95=B4=E5=AD=90=E5=88=86=E7=B1=BB?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

æ›´æ–°é“¶åˆ¶å“åˆ†ç±»ç³»ç»Ÿï¼š
- æ–°å¢å…¶å®ƒå¤§ç±»ï¼ŒåŒ…å«ï¼šé“¶æ¿ã€é“¶çº¿ã€é“¶èŠ±è¾¹
- æ›´æ–°é…ä»¶å¤§ç±»å­ç±»ï¼šåŠå å¤¹ã€é—´ç ã€ç æ‰˜ã€èŠ±è¾¹ã€æ°´æ»´æ‰£/æ–¹æ‰£/å¼¹ç°§æ‰£ã€æ’æ‰£ã€ç£é“æ‰£ã€å¼‚å½¢æ‰£ã€é“¾æ¥ä»¶ã€è€³ç¯/è€³é’©ã€è€³é’‰ã€è€³é€¼ã€é“¾å¤´å¤¹ã€è¾¹æ¡†ã€ç é’ˆã€å°¾åœˆã€OTæ‰£ã€é—´é€šã€å­—å°ç‰Œ
- æ›´æ–°å®çŸ³æ‰˜å¤§ç±»å­ç±»ï¼šæˆ’å­æ‰˜ã€è€³ç¯æ‰˜ã€è€³é’‰æ‰˜ã€åŠå æ‰˜ã€æ‰‹é“¾æ‰˜ã€æ‰‹é•¯æ‰˜ã€é¦–é¥°é…ä»¶æ‰˜
- æ›´æ–°é“¾æ¡å¤§ç±»å­ç±»ï¼šå»¶é•¿é“¾ã€é¡¹é“¾ã€æ•£é“¾ã€çš®ç»³
- æ›´æ–°æ™ºèƒ½è¯†åˆ«é€»è¾‘ï¼Œæ”¯æŒæ–°åˆ†ç±»çš„è‡ªåŠ¨è¯†åˆ«
- Excelå¯¼å…¥å·²æœ‰åˆ†ç±»é€‰æ‹©åŠŸèƒ½ï¼Œå¯é€‰æ‹©å¯¼å…¥æ‰€æœ‰åˆ†ç±»æˆ–ä»…å½“å‰åˆ†ç±»
- äº§å“åˆ—è¡¨å·²æœ‰åŒæ­¥çŠ¶æ€åˆ—ï¼Œæ˜¾ç¤ºäº§å“åŒæ­¥çŠ¶æ€
---
 src/app/silver-quote/page.tsx | 144 ++++++++++++++++++++++------------
 1 file changed, 94 insertions(+), 50 deletions(-)

diff --git a/src/app/silver-quote/page.tsx b/src/app/silver-quote/page.tsx
index f12c1df..a87d8d1 100644
--- a/src/app/silver-quote/page.tsx
+++ b/src/app/silver-quote/page.tsx
@@ -12,6 +12,7 @@ export const SILVER_PRODUCT_CATEGORIES = [
   "é…ä»¶",
   "å®çŸ³æ‰˜",
   "é“¾æ¡",
+  "å…¶å®ƒ",
 ] as const;
 
 export type SilverProductCategory = typeof SILVER_PRODUCT_CATEGORIES[number];
@@ -19,31 +20,45 @@ export type SilverProductCategory = typeof SILVER_PRODUCT_CATEGORIES[number];
 // å¤§åˆ†ç±»å’Œå­åˆ†ç±»çš„æ˜ å°„å…³ç³»
 export const SILVER_SUB_CATEGORIES: Record<SilverProductCategory, string[]> = {
   "é…ä»¶": [
-    "è€³ç¯/è€³é€¼",
-    "æ‰£å­",
-    "å¼€å£åœˆ/é—­å£åœˆ",
-    "åœ†ç ",
-    "è½¦èŠ±ç ",
-    "å®šä½ç /çŸ­ç®¡",
-    "åŒ…æ‰£",
-    "å­—å°ç‰‡/åŠç‰Œ",
-    "ç é’ˆ",
-    "ç©ºå¿ƒç®¡",
-    "ç æ‰˜",
     "åŠå å¤¹",
-    "é•¶åµŒé…ä»¶",
-    "çç é…ä»¶",
-    "é“¶çº¿",
+    "é—´ç ",
+    "ç æ‰˜",
+    "èŠ±è¾¹",
+    "æ°´æ»´æ‰£/æ–¹æ‰£/å¼¹ç°§æ‰£",
+    "æ’æ‰£",
+    "ç£é“æ‰£",
+    "å¼‚å½¢æ‰£",
+    "é“¾æ¥ä»¶",
+    "è€³ç¯/è€³é’©",
+    "è€³é’‰",
+    "è€³é€¼",
+    "é“¾å¤´å¤¹",
+    "è¾¹æ¡†",
+    "ç é’ˆ",
+    "å°¾åœˆ",
+    "OTæ‰£",
+    "é—´é€š",
+    "å­—å°ç‰Œ",
   ],
   "å®çŸ³æ‰˜": [
     "æˆ’å­æ‰˜",
     "è€³ç¯æ‰˜",
     "è€³é’‰æ‰˜",
     "åŠå æ‰˜",
+    "æ‰‹é“¾æ‰˜",
+    "æ‰‹é•¯æ‰˜",
+    "é¦–é¥°é…ä»¶æ‰˜",
   ],
   "é“¾æ¡": [
-    "é“¶é“¾",
     "å»¶é•¿é“¾",
+    "é¡¹é“¾",
+    "æ•£é“¾",
+    "çš®ç»³",
+  ],
+  "å…¶å®ƒ": [
+    "é“¶æ¿",
+    "é“¶çº¿",
+    "é“¶èŠ±è¾¹",
   ],
 };
 
@@ -56,37 +71,52 @@ const SILVER_DATA_VERSION = 1;
 const detectSilverCategoryFromName = (productName: string): SilverProductCategory | null => {
   const name = productName.toLowerCase();
 
-  // å®çŸ³æ‰˜ç±»å…³é”®è¯ - å¿…é¡»æ”¾åœ¨å‰é¢ï¼Œé¿å…è¢«å…¶ä»–å…³é”®è¯åŒ¹é…
+  // å…¶å®ƒç±»å…³é”®è¯ - ä¼˜å…ˆçº§æœ€é«˜
+  const otherKeywords = [
+    "é“¶æ¿", "é“¶èŠ±è¾¹"
+  ];
+
+  // å®çŸ³æ‰˜ç±»å…³é”®è¯
   const settingsKeywords = [
-    "æˆ’å­æ‰˜", "è€³ç¯æ‰˜", "è€³é’‰æ‰˜", "åŠå æ‰˜",
+    "æˆ’å­æ‰˜", "è€³ç¯æ‰˜", "è€³é’‰æ‰˜", "åŠå æ‰˜", "æ‰‹é“¾æ‰˜", "æ‰‹é•¯æ‰˜", "é¦–é¥°é…ä»¶æ‰˜",
     "æˆ’æŒ‡æ‰˜", "è€³é¥°æ‰˜", "åŠé¥°æ‰˜", "é•¶åµŒæ‰˜"
   ];
 
   // é“¾æ¡ç±»å…³é”®è¯
   const chainKeywords = [
-    "é“¶é“¾", "å»¶é•¿é“¾", "é¡¹é“¾", "æ‰‹é“¾", "é“¾å­"
+    "å»¶é•¿é“¾", "é¡¹é“¾", "æ•£é“¾", "çš®ç»³", "æ‰‹é“¾", "é“¾å­"
   ];
 
-  // é…ä»¶ç±»å…³é”®è¯ - æ”¾åœ¨æœ€åï¼Œä½¿ç”¨æ›´å…·ä½“çš„å…³é”®è¯ï¼Œé¿å…è¯¯åŒ¹é…
+  // é…ä»¶ç±»å…³é”®è¯ - ä½¿ç”¨æ›´å…·ä½“çš„å…³é”®è¯
   const accessoriesKeywords = [
-    "æ°´æ»´æ‰£", "é¾™è™¾æ‰£", "èºä¸æ‰£", "å¼¹ç°§æ‰£",
-    "å¼€å£åœˆ", "é—­å£åœˆ",
-    "åœ†ç ", "è½¦èŠ±ç ", "è½¦èŠ±",
-    "å®šä½ç ", "çŸ­ç®¡",
-    "åŒ…æ‰£",
-    "å­—å°", "åŠç‰Œ",
+    "åŠå å¤¹",
+    "é—´ç ",
+    "èŠ±è¾¹",
+    "æ°´æ»´æ‰£", "æ–¹æ‰£", "å¼¹ç°§æ‰£",
+    "æ’æ‰£",
+    "ç£é“æ‰£",
+    "å¼‚å½¢æ‰£",
+    "é“¾æ¥ä»¶",
+    "è€³ç¯", "è€³é’©",
+    "è€³é€¼",
+    "é“¾å¤´å¤¹",
+    "è¾¹æ¡†",
     "ç é’ˆ",
-    "ç©ºå¿ƒç®¡",
+    "å°¾åœˆ",
+    "OTæ‰£",
+    "é—´é€š",
+    "å­—å°ç‰Œ",
     "ç æ‰˜", "æ‰˜ç ",
-    "é•¶åµŒé…ä»¶", "é•¶åµŒ",
-    "çç é…ä»¶", "çç ",
-    "é“¶çº¿",
-    "è€³é€¼", "è€³å¤¹",
   ];
 
-  // æŒ‰ä¼˜å…ˆçº§æ£€æŸ¥ï¼šå®çŸ³æ‰˜ > é“¾æ¡ > é…ä»¶
+  // æŒ‰ä¼˜å…ˆçº§æ£€æŸ¥ï¼šå…¶å®ƒ > å®çŸ³æ‰˜ > é“¾æ¡ > é…ä»¶
+
+  // å…ˆæ£€æŸ¥å…¶å®ƒç±»ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
+  if (otherKeywords.some(keyword => name.includes(keyword))) {
+    return "å…¶å®ƒ";
+  }
 
-  // å…ˆæ£€æŸ¥å®çŸ³æ‰˜ç±»ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
+  // å†æ£€æŸ¥å®çŸ³æ‰˜ç±»
   if (settingsKeywords.some(keyword => name.includes(keyword))) {
     return "å®çŸ³æ‰˜";
   }
@@ -110,32 +140,46 @@ const detectSilverSubCategoryFromName = (productName: string): string | null =>
 
   // å®šä¹‰å­åˆ†ç±»å…³é”®è¯ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼šå…·ä½“å…³é”®è¯ä¼˜å…ˆï¼‰
   const subCategoryKeywords: Array<{ subCat: string; keywords: string[] }> = [
-    // å®çŸ³æ‰˜ç±»ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
+    // å…¶å®ƒç±»ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
+    { subCat: "é“¶æ¿", keywords: ["é“¶æ¿"] },
+    { subCat: "é“¶çº¿", keywords: ["é“¶çº¿"] },
+    { subCat: "é“¶èŠ±è¾¹", keywords: ["é“¶èŠ±è¾¹", "èŠ±è¾¹"] },
+
+    // å®çŸ³æ‰˜ç±»
     { subCat: "æˆ’å­æ‰˜", keywords: ["æˆ’å­æ‰˜", "æˆ’æŒ‡æ‰˜"] },
     { subCat: "è€³ç¯æ‰˜", keywords: ["è€³ç¯æ‰˜"] },
     { subCat: "è€³é’‰æ‰˜", keywords: ["è€³é’‰æ‰˜"] },
     { subCat: "åŠå æ‰˜", keywords: ["åŠå æ‰˜"] },
+    { subCat: "æ‰‹é“¾æ‰˜", keywords: ["æ‰‹é“¾æ‰˜"] },
+    { subCat: "æ‰‹é•¯æ‰˜", keywords: ["æ‰‹é•¯æ‰˜"] },
+    { subCat: "é¦–é¥°é…ä»¶æ‰˜", keywords: ["é¦–é¥°é…ä»¶æ‰˜"] },
+
+    // é“¾æ¡ç±»
+    { subCat: "å»¶é•¿é“¾", keywords: ["å»¶é•¿é“¾"] },
+    { subCat: "é¡¹é“¾", keywords: ["é¡¹é“¾", "é“¶é“¾"] },
+    { subCat: "æ•£é“¾", keywords: ["æ•£é“¾"] },
+    { subCat: "çš®ç»³", keywords: ["çš®ç»³"] },
 
     // é…ä»¶ç±» - ä½¿ç”¨æ›´å…·ä½“çš„å…³é”®è¯
-    { subCat: "æ‰£å­", keywords: ["æ°´æ»´æ‰£", "é¾™è™¾æ‰£", "èºä¸æ‰£", "å¼¹ç°§æ‰£", "å¼¹ç°§å¤¹æ‰£"] },
-    { subCat: "å¼€å£åœˆ/é—­å£åœˆ", keywords: ["å¼€å£åœˆ", "é—­å£åœˆ"] },
-    { subCat: "åœ†ç ", keywords: ["åœ†ç "] },
-    { subCat: "è½¦èŠ±ç ", keywords: ["è½¦èŠ±ç ", "è½¦èŠ±"] },
-    { subCat: "å®šä½ç /çŸ­ç®¡", keywords: ["å®šä½ç ", "çŸ­ç®¡"] },
-    { subCat: "åŒ…æ‰£", keywords: ["åŒ…æ‰£"] },
-    { subCat: "å­—å°ç‰‡/åŠç‰Œ", keywords: ["å­—å°", "åŠç‰Œ"] },
+    { subCat: "åŠå å¤¹", keywords: ["åŠå å¤¹"] },
+    { subCat: "é—´ç ", keywords: ["é—´ç "] },
+    { subCat: "èŠ±è¾¹", keywords: ["èŠ±è¾¹"] },
+    { subCat: "æ°´æ»´æ‰£/æ–¹æ‰£/å¼¹ç°§æ‰£", keywords: ["æ°´æ»´æ‰£", "æ–¹æ‰£", "å¼¹ç°§æ‰£"] },
+    { subCat: "æ’æ‰£", keywords: ["æ’æ‰£"] },
+    { subCat: "ç£é“æ‰£", keywords: ["ç£é“æ‰£"] },
+    { subCat: "å¼‚å½¢æ‰£", keywords: ["å¼‚å½¢æ‰£"] },
+    { subCat: "é“¾æ¥ä»¶", keywords: ["é“¾æ¥ä»¶"] },
+    { subCat: "è€³ç¯/è€³é’©", keywords: ["è€³ç¯", "è€³é’©"] },
+    { subCat: "è€³é’‰", keywords: ["è€³é’‰"] },
+    { subCat: "è€³é€¼", keywords: ["è€³é€¼", "è€³å¤¹"] },
+    { subCat: "é“¾å¤´å¤¹", keywords: ["é“¾å¤´å¤¹"] },
+    { subCat: "è¾¹æ¡†", keywords: ["è¾¹æ¡†"] },
     { subCat: "ç é’ˆ", keywords: ["ç é’ˆ"] },
-    { subCat: "ç©ºå¿ƒç®¡", keywords: ["ç©ºå¿ƒç®¡"] },
+    { subCat: "å°¾åœˆ", keywords: ["å°¾åœˆ"] },
+    { subCat: "OTæ‰£", keywords: ["OTæ‰£", "otæ‰£"] },
+    { subCat: "é—´é€š", keywords: ["é—´é€š"] },
+    { subCat: "å­—å°ç‰Œ", keywords: ["å­—å°ç‰Œ"] },
     { subCat: "ç æ‰˜", keywords: ["ç æ‰˜", "æ‰˜ç "] },
-    { subCat: "åŠå å¤¹", keywords: ["åŠå å¤¹"] },
-    { subCat: "é•¶åµŒé…ä»¶", keywords: ["é•¶åµŒé…ä»¶", "é•¶åµŒ"] },
-    { subCat: "çç é…ä»¶", keywords: ["çç é…ä»¶", "çç "] },
-    { subCat: "é“¶çº¿", keywords: ["é“¶çº¿"] },
-    { subCat: "è€³ç¯/è€³é€¼", keywords: ["è€³ç¯", "è€³é€¼", "è€³å¤¹"] },
-
-    // é“¾æ¡ç±»
-    { subCat: "é“¶é“¾", keywords: ["é“¶é“¾", "é¡¹é“¾", "æ‰‹é“¾"] },
-    { subCat: "å»¶é•¿é“¾", keywords: ["å»¶é•¿é“¾"] },
   ];
 
   // æ‰¾å‡ºæ‰€æœ‰åŒ¹é…çš„å­åˆ†ç±»åŠå…¶åŒ¹é…çš„å…³é”®è¯
-- 
2.43.0

From 320098864839435f8dd58137235ef375197fb0c1 Mon Sep 17 00:00:00 2001
From: Marblee <3440803185179952-Marblee@noreply.coze.cn>
Date: Wed, 7 Jan 2026 12:44:14 +0800
Subject: [PATCH 08/13] =?UTF-8?q?feat(silver-quote):=20=E6=B7=BB=E5=8A=A0?=
 =?UTF-8?q?=E4=BA=A7=E5=93=81=E5=BD=93=E6=89=B9=E6=AC=A1=E6=95=B0=E9=87=8F?=
 =?UTF-8?q?=E5=88=97?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

- åœ¨SilverProductå’ŒSilverPriceHistoryæ¥å£ä¸­æ·»åŠ batchQuantityå­—æ®µ
- äº§å“åˆ—è¡¨è¡¨å¤´æ·»åŠ å½“æ‰¹æ¬¡æ•°é‡åˆ—ï¼Œä½äºæ‰¹å‘ä»·å’Œç´¯è®¡æ•°é‡ä¹‹é—´
- å½“æ‰¹æ¬¡æ•°é‡æ”¯æŒè¡Œå†…ç¼–è¾‘ï¼Œstepä¸º1
- ç´¯è®¡æ•°é‡åˆ—åŠ ç²—æ˜¾ç¤ºï¼Œçªå‡ºé‡è¦æ€§
- Excelå¯¼å‡ºåŒ…å«å½“æ‰¹æ¬¡æ•°é‡åˆ—
- Excelå¯¼å…¥æ”¯æŒå½“æ‰¹æ¬¡æ•°é‡åˆ—
- æ›´æ–°æ‰€æœ‰ç›¸å…³å‡½æ•°ï¼šaddProductã€saveToHistoryã€å¯¼å…¥å¯¼å‡ºç­‰
- æ›´æ–°æš‚æ— æ•°æ®æç¤ºçš„colSpanä¸º20
---
 src/app/silver-quote/page.tsx | 25 +++++++++++++++++++++----
 1 file changed, 21 insertions(+), 4 deletions(-)

diff --git a/src/app/silver-quote/page.tsx b/src/app/silver-quote/page.tsx
index a87d8d1..c1cfd7e 100644
--- a/src/app/silver-quote/page.tsx
+++ b/src/app/silver-quote/page.tsx
@@ -272,6 +272,7 @@ interface SilverProduct {
   commission: number;  // ä½£é‡‘ï¼ˆäººæ°‘å¸ï¼‰
   supplierCode: string;  // ä¾›åº”å•†ä»£ç 
   remarks: string;  // å¤‡æ³¨
+  batchQuantity: number;  // å½“æ‰¹æ¬¡æ•°é‡
   quantity: number;  // ç´¯è®¡æ•°é‡
   quantityDate: string;  // æ•°é‡å½•å…¥æ—¶é—´
   laborCostDate: string;
@@ -305,7 +306,8 @@ interface SilverPriceHistory {
   commission: number;
   supplierCode: string;
   remarks: string;
-  quantity: number;
+  batchQuantity: number;  // å½“æ‰¹æ¬¡æ•°é‡
+  quantity: number;  // ç´¯è®¡æ•°é‡
   quantityDate: string;
   laborCostDate: string;
   accessoryCostDate: string;
@@ -583,6 +585,7 @@ function SilverQuotePage() {
       commission: 0,
       supplierCode: "E1",
       remarks: "",
+      batchQuantity: 0,  // å½“æ‰¹æ¬¡æ•°é‡
       quantity: 0,
       quantityDate: "",
       laborCostDate: "",
@@ -670,6 +673,7 @@ function SilverQuotePage() {
       commission: product.commission,
       supplierCode: product.supplierCode,
       remarks: product.remarks,
+      batchQuantity: product.batchQuantity,
       quantity: product.quantity,
       quantityDate: product.quantityDate,
       laborCostDate: product.laborCostDate,
@@ -903,8 +907,9 @@ function SilverQuotePage() {
       "ä¾›åº”å•†ä»£ç ": p.supplierCode,
       "é›¶å”®ä»·(CAD$)": p.retailPrice.toFixed(2),
       "æ‰¹å‘ä»·(CAD$)": p.wholesalePrice.toFixed(2),
+      "å½“æ‰¹æ¬¡æ•°é‡": p.batchQuantity || 0,
+      "ç´¯è®¡æ•°é‡": p.quantity || 0,
       "å¤‡æ³¨": p.remarks,
-      "ç´¯è®¡æ•°é‡": p.quantity,
       "æ›´æ–°æ—¶é—´": formatDate(p.timestamp),
     }));
 
@@ -973,6 +978,7 @@ function SilverQuotePage() {
           commission: 0,
           supplierCode: row["ä¾›åº”å•†ä»£ç "] || "E1",
           remarks: row["å¤‡æ³¨"] || "",
+          batchQuantity: Number(row["å½“æ‰¹æ¬¡æ•°é‡"]) || 0,
           quantity: Number(row["ç´¯è®¡æ•°é‡"]) || 0,
           quantityDate: "",
           laborCostDate: "",
@@ -1325,6 +1331,7 @@ function SilverQuotePage() {
                   commission: 0,
                   supplierCode: "E1",
                   remarks: "",
+                  batchQuantity: 0,
                   quantity: 0,
                   quantityDate: "",
                   laborCostDate: "",
@@ -1494,6 +1501,7 @@ function SilverQuotePage() {
                     <th className="border border-gray-200 px-3 py-2 text-left text-black">ä¾›åº”å•†ä»£ç </th>
                     <th className="border border-gray-200 px-3 py-2 text-right text-black">é›¶å”®ä»·(CAD$)</th>
                     <th className="border border-gray-200 px-3 py-2 text-right text-black">æ‰¹å‘ä»·(CAD$)</th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">å½“æ‰¹æ¬¡æ•°é‡</th>
                     <th className="border border-gray-200 px-3 py-2 text-right text-black">ç´¯è®¡æ•°é‡</th>
                     <th className="border border-gray-200 px-3 py-2 text-left text-black">å¤‡æ³¨</th>
                     <th className="border border-gray-200 px-3 py-2 text-left text-black">æ›´æ–°æ—¶é—´</th>
@@ -1628,7 +1636,16 @@ function SilverQuotePage() {
                       <td className="border border-gray-200 px-3 py-2 text-right font-bold text-green-700">
                         {product.wholesalePrice.toFixed(2)}
                       </td>
-                      <td className="border border-gray-200 px-3 py-2 text-right">
+                      <td className="border border-gray-200 px-3 py-2">
+                        <input
+                          type="number"
+                          step="1"
+                          value={product.batchQuantity || 0}
+                          onChange={(e) => updateProduct(product.id, "batchQuantity", Number(e.target.value))}
+                          className="w-full border border-gray-200 rounded px-2 py-1 text-black text-right"
+                        />
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2 text-right font-bold text-black">
                         {product.quantity || 0}
                       </td>
                       <td className="border border-gray-200 px-3 py-2">
@@ -1646,7 +1663,7 @@ function SilverQuotePage() {
                   ))}
                   {products.filter(p => p.category === currentCategory).length === 0 && (
                     <tr>
-                      <td colSpan={19} className="border border-gray-200 px-3 py-4 text-center text-black">
+                      <td colSpan={20} className="border border-gray-200 px-3 py-4 text-center text-black">
                         æš‚æ— {currentCategory}äº§å“æ•°æ®
                       </td>
                     </tr>
-- 
2.43.0

From 065a346e4fcca0954873c063b09eb7b385867579 Mon Sep 17 00:00:00 2001
From: Marblee <3440803185179952-Marblee@noreply.coze.cn>
Date: Wed, 7 Jan 2026 12:46:31 +0800
Subject: [PATCH 09/13] =?UTF-8?q?fix:=20=E5=B0=86=E9=93=B6=E5=88=B6?=
 =?UTF-8?q?=E5=93=81=E9=A1=B5=E9=9D=A2=E7=9A=84=E5=BD=93=E6=89=B9=E6=AC=A1?=
 =?UTF-8?q?=E6=95=B0=E9=87=8F=E6=94=B9=E4=B8=BA=E6=95=B0=E9=87=8F?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 src/app/silver-quote/page.tsx | 12 ++++++------
 1 file changed, 6 insertions(+), 6 deletions(-)

diff --git a/src/app/silver-quote/page.tsx b/src/app/silver-quote/page.tsx
index c1cfd7e..ad85417 100644
--- a/src/app/silver-quote/page.tsx
+++ b/src/app/silver-quote/page.tsx
@@ -272,7 +272,7 @@ interface SilverProduct {
   commission: number;  // ä½£é‡‘ï¼ˆäººæ°‘å¸ï¼‰
   supplierCode: string;  // ä¾›åº”å•†ä»£ç 
   remarks: string;  // å¤‡æ³¨
-  batchQuantity: number;  // å½“æ‰¹æ¬¡æ•°é‡
+  batchQuantity: number;  // æ•°é‡
   quantity: number;  // ç´¯è®¡æ•°é‡
   quantityDate: string;  // æ•°é‡å½•å…¥æ—¶é—´
   laborCostDate: string;
@@ -306,7 +306,7 @@ interface SilverPriceHistory {
   commission: number;
   supplierCode: string;
   remarks: string;
-  batchQuantity: number;  // å½“æ‰¹æ¬¡æ•°é‡
+  batchQuantity: number;  // æ•°é‡
   quantity: number;  // ç´¯è®¡æ•°é‡
   quantityDate: string;
   laborCostDate: string;
@@ -585,7 +585,7 @@ function SilverQuotePage() {
       commission: 0,
       supplierCode: "E1",
       remarks: "",
-      batchQuantity: 0,  // å½“æ‰¹æ¬¡æ•°é‡
+      batchQuantity: 0,  // æ•°é‡
       quantity: 0,
       quantityDate: "",
       laborCostDate: "",
@@ -907,7 +907,7 @@ function SilverQuotePage() {
       "ä¾›åº”å•†ä»£ç ": p.supplierCode,
       "é›¶å”®ä»·(CAD$)": p.retailPrice.toFixed(2),
       "æ‰¹å‘ä»·(CAD$)": p.wholesalePrice.toFixed(2),
-      "å½“æ‰¹æ¬¡æ•°é‡": p.batchQuantity || 0,
+      "æ•°é‡": p.batchQuantity || 0,
       "ç´¯è®¡æ•°é‡": p.quantity || 0,
       "å¤‡æ³¨": p.remarks,
       "æ›´æ–°æ—¶é—´": formatDate(p.timestamp),
@@ -978,7 +978,7 @@ function SilverQuotePage() {
           commission: 0,
           supplierCode: row["ä¾›åº”å•†ä»£ç "] || "E1",
           remarks: row["å¤‡æ³¨"] || "",
-          batchQuantity: Number(row["å½“æ‰¹æ¬¡æ•°é‡"]) || 0,
+          batchQuantity: Number(row["æ•°é‡"]) || 0,
           quantity: Number(row["ç´¯è®¡æ•°é‡"]) || 0,
           quantityDate: "",
           laborCostDate: "",
@@ -1501,7 +1501,7 @@ function SilverQuotePage() {
                     <th className="border border-gray-200 px-3 py-2 text-left text-black">ä¾›åº”å•†ä»£ç </th>
                     <th className="border border-gray-200 px-3 py-2 text-right text-black">é›¶å”®ä»·(CAD$)</th>
                     <th className="border border-gray-200 px-3 py-2 text-right text-black">æ‰¹å‘ä»·(CAD$)</th>
-                    <th className="border border-gray-200 px-3 py-2 text-right text-black">å½“æ‰¹æ¬¡æ•°é‡</th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">æ•°é‡</th>
                     <th className="border border-gray-200 px-3 py-2 text-right text-black">ç´¯è®¡æ•°é‡</th>
                     <th className="border border-gray-200 px-3 py-2 text-left text-black">å¤‡æ³¨</th>
                     <th className="border border-gray-200 px-3 py-2 text-left text-black">æ›´æ–°æ—¶é—´</th>
-- 
2.43.0

