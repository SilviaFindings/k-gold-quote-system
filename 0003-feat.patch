From e2690bbce722216a70704bd8684f63f5029d6b0c Mon Sep 17 00:00:00 2001
From: Marblee <3440803185179952-Marblee@noreply.coze.cn>
Date: Wed, 7 Jan 2026 12:09:16 +0800
Subject: [PATCH 03/13] =?UTF-8?q?feat:=20=E5=AE=8C=E6=88=90=E9=93=B6?=
 =?UTF-8?q?=E5=88=B6=E5=93=81=E6=8A=A5=E4=BB=B7=E5=B9=B3=E5=8F=B0=E6=89=80?=
 =?UTF-8?q?=E6=9C=89=E5=8A=9F=E8=83=BD=E5=BC=80=E5=8F=91?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 src/app/silver-quote/page.tsx | 743 +++++++++++++++++++++++++++++++++-
 1 file changed, 739 insertions(+), 4 deletions(-)

diff --git a/src/app/silver-quote/page.tsx b/src/app/silver-quote/page.tsx
index 38499ea..4c5eb01 100644
--- a/src/app/silver-quote/page.tsx
+++ b/src/app/silver-quote/page.tsx
@@ -440,19 +440,479 @@ function SilverQuotePage() {
     }
   };
 
-  // ========== é¡µé¢UI ==========
+  // ========== äº§å“å’Œå†å²è®°å½•çŠ¶æ€ç®¡ç† ==========
 
   const [products, setProducts] = useState<SilverProduct[]>([]);
+  const [priceHistory, setPriceHistory] = useState<SilverPriceHistory[]>([]);
   const [currentCategory, setCurrentCategory] = useState<SilverProductCategory>("é…ä»¶");
+  const [currentSubCategory, setCurrentSubCategory] = useState<string | null>(null);
+
+  // æ·»åŠ äº§å“
+  const addProduct = () => {
+    const newProduct: SilverProduct = {
+      id: Date.now().toString(),
+      category: currentCategory,
+      subCategory: SILVER_SUB_CATEGORIES[currentCategory][0],
+      productCode: "",
+      productName: "",
+      specification: "",
+      weight: 0,
+      laborCost: 0,
+      silverColor: "é“¶è‰²",
+      silverPrice: silverPrice,
+      wholesalePrice: 0,
+      retailPrice: 0,
+      accessoryCost: 0,
+      stoneCost: 0,
+      platingCost: 0,
+      moldCost: 0,
+      commission: 0,
+      supplierCode: "E1",
+      remarks: "",
+      quantity: 0,
+      quantityDate: "",
+      laborCostDate: "",
+      accessoryCostDate: "",
+      stoneCostDate: "",
+      platingCostDate: "",
+      moldCostDate: "",
+      commissionDate: "",
+      timestamp: new Date().toISOString(),
+    };
+
+    setProducts([...products, newProduct]);
+  };
+
+  // æ›´æ–°äº§å“
+  const updateProduct = (id: string, field: keyof SilverProduct, value: any) => {
+    const updatedProducts = products.map(p => {
+      if (p.id === id) {
+        const updated = { ...p, [field]: value };
+
+        // æ™ºèƒ½è¯†åˆ«è´§å·å’Œåˆ†ç±»
+        if (field === "productCode" && value) {
+          const parsed = parseSilverProductCode(value);
+          updated.supplierCode = parsed.supplierCode;
+        }
+
+        // æ™ºèƒ½è¯†åˆ«äº§å“åç§°å¯¹åº”çš„åˆ†ç±»
+        if (field === "productName" && value) {
+          const detectedCategory = detectSilverCategoryFromName(value);
+          const detectedSubCategory = detectSilverSubCategoryFromName(value);
+          if (detectedCategory) {
+            updated.category = detectedCategory;
+          }
+          if (detectedSubCategory) {
+            updated.subCategory = detectedSubCategory;
+          }
+        }
+
+        // è‡ªåŠ¨è®¡ç®—ä»·æ ¼
+        updated.retailPrice = calculateSilverPrice(updated, true);
+        updated.wholesalePrice = calculateSilverPrice(updated, false);
+
+        return updated;
+      }
+      return p;
+    });
+
+    setProducts(updatedProducts);
+    saveToLocalStorage(updatedProducts);
+  };
+
+  // åˆ é™¤äº§å“
+  const deleteProduct = (id: string) => {
+    if (window.confirm("ç¡®è®¤åˆ é™¤æ­¤äº§å“ï¼Ÿ")) {
+      setProducts(products.filter(p => p.id !== id));
+      setPriceHistory(priceHistory.filter(h => h.productId !== id));
+      saveToLocalStorage(products.filter(p => p.id !== id), priceHistory.filter(h => h.productId !== id));
+    }
+  };
+
+  // ä¿å­˜å†å²è®°å½•
+  const saveToHistory = (product: SilverProduct) => {
+    const historyItem: SilverPriceHistory = {
+      id: Date.now().toString(),
+      productId: product.id,
+      category: product.category,
+      subCategory: product.subCategory,
+      productCode: product.productCode,
+      productName: product.productName,
+      specification: product.specification,
+      weight: product.weight,
+      laborCost: product.laborCost,
+      silverColor: product.silverColor,
+      silverPrice: product.silverPrice,
+      wholesalePrice: product.wholesalePrice,
+      retailPrice: product.retailPrice,
+      accessoryCost: product.accessoryCost,
+      stoneCost: product.stoneCost,
+      platingCost: product.platingCost,
+      moldCost: product.moldCost,
+      commission: product.commission,
+      supplierCode: product.supplierCode,
+      remarks: product.remarks,
+      quantity: product.quantity,
+      quantityDate: product.quantityDate,
+      laborCostDate: product.laborCostDate,
+      accessoryCostDate: product.accessoryCostDate,
+      stoneCostDate: product.stoneCostDate,
+      platingCostDate: product.platingCostDate,
+      moldCostDate: product.moldCostDate,
+      commissionDate: product.commissionDate,
+      timestamp: new Date().toISOString(),
+    };
+
+    setPriceHistory([historyItem, ...priceHistory]);
+    saveToLocalStorage(products, [historyItem, ...priceHistory]);
+  };
+
+  // æœ¬åœ°å­˜å‚¨æ“ä½œ
+  const saveToLocalStorage = (productsList?: SilverProduct[], historyList?: SilverPriceHistory[]) => {
+    const prods = productsList || products;
+    const hist = historyList || priceHistory;
+
+    localStorage.setItem("silverProducts", JSON.stringify(prods));
+    localStorage.setItem("silverPriceHistory", JSON.stringify(hist));
+  };
+
+  // ========== äº‘ç«¯åŒæ­¥åŠŸèƒ½ ==========
+
+  const [showSyncMenu, setShowSyncMenu] = useState(false);
+  const [cloudDataExists, setCloudDataExists] = useState(false);
+  const [syncStatus, setSyncStatus] = useState<"idle" | "syncing" | "success" | "error">("idle");
+  const [syncMessage, setSyncMessage] = useState("");
+
+  // æ£€æŸ¥äº‘ç«¯æ•°æ®æ˜¯å¦å­˜åœ¨
+  const checkCloudData = async () => {
+    try {
+      const token = localStorage.getItem('auth_token');
+      if (!token) {
+        setCloudDataExists(false);
+        return;
+      }
+
+      const response = await fetch('/api/silver-products?limit=1', {
+        headers: {
+          Authorization: `Bearer ${token}`,
+        }
+      });
+
+      if (response.ok) {
+        const data = await response.json();
+        setCloudDataExists(data && data.length > 0);
+      }
+    } catch (error) {
+      console.error('æ£€æŸ¥äº‘ç«¯æ•°æ®å¤±è´¥:', error);
+      setCloudDataExists(false);
+    }
+  };
+
+  // ä¸Šä¼ æ•°æ®åˆ°äº‘ç«¯
+  const uploadToCloud = async () => {
+    setSyncStatus("syncing");
+    setSyncMessage("æ­£åœ¨ä¸Šä¼ æ•°æ®åˆ°äº‘ç«¯...");
+
+    try {
+      const token = localStorage.getItem('auth_token');
+      if (!token) {
+        alert('è¯·å…ˆç™»å½•');
+        setSyncStatus("error");
+        setSyncMessage("éœ€è¦ç™»å½•");
+        return;
+      }
+
+      // ä¸Šä¼ é“¶åˆ¶å“æ•°æ®
+      const response = await fetch('/api/silver-sync', {
+        method: 'POST',
+        headers: {
+          'Content-Type': 'application/json',
+          'Authorization': `Bearer ${token}`,
+        },
+        body: JSON.stringify({
+          products: products,
+          history: priceHistory,
+          silverPrice: silverPrice,
+          coefficients: silverCoefficients,
+        }),
+      });
+
+      if (response.ok) {
+        setSyncStatus("success");
+        setSyncMessage("æ•°æ®ä¸Šä¼ æˆåŠŸï¼");
+        setCloudDataExists(true);
+        setTimeout(() => {
+          setSyncStatus("idle");
+          setSyncMessage("");
+          setShowSyncMenu(false);
+        }, 2000);
+      } else {
+        throw new Error('ä¸Šä¼ å¤±è´¥');
+      }
+    } catch (error) {
+      console.error('ä¸Šä¼ åˆ°äº‘ç«¯å¤±è´¥:', error);
+      setSyncStatus("error");
+      setSyncMessage("ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•");
+    }
+  };
+
+  // ä»äº‘ç«¯ä¸‹è½½æ•°æ®
+  const downloadFromCloud = async (mode: "replace" | "merge") => {
+    setSyncStatus("syncing");
+    setSyncMessage("æ­£åœ¨ä»äº‘ç«¯ä¸‹è½½æ•°æ®...");
+
+    try {
+      const token = localStorage.getItem('auth_token');
+      if (!token) {
+        alert('è¯·å…ˆç™»å½•');
+        setSyncStatus("error");
+        setSyncMessage("éœ€è¦ç™»å½•");
+        return;
+      }
+
+      const response = await fetch('/api/silver-sync', {
+        headers: {
+          'Authorization': `Bearer ${token}`,
+        }
+      });
+
+      if (response.ok) {
+        const data = await response.json();
+
+        if (mode === "replace") {
+          setProducts(data.products || []);
+          setPriceHistory(data.history || []);
+          setSilverPrice(data.silverPrice || 20);
+          setSilverCoefficients(data.coefficients || silverCoefficients);
+        } else {
+          // åˆå¹¶æ¨¡å¼ï¼šä¿ç•™æœ¬åœ°æ•°æ®ï¼Œæ·»åŠ äº‘ç«¯ä¸å­˜åœ¨çš„æ•°æ®
+          const existingIds = new Set(products.map(p => p.id));
+          const newProducts = (data.products || []).filter((p: SilverProduct) => !existingIds.has(p.id));
+          setProducts([...products, ...newProducts]);
+          setPriceHistory([...priceHistory, ...(data.history || [])]);
+        }
+
+        setSyncStatus("success");
+        setSyncMessage("æ•°æ®ä¸‹è½½æˆåŠŸï¼");
+        setTimeout(() => {
+          setSyncStatus("idle");
+          setSyncMessage("");
+          setShowSyncMenu(false);
+        }, 2000);
+      } else {
+        throw new Error('ä¸‹è½½å¤±è´¥');
+      }
+    } catch (error) {
+      console.error('ä»äº‘ç«¯ä¸‹è½½å¤±è´¥:', error);
+      setSyncStatus("error");
+      setSyncMessage("ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•");
+    }
+  };
+
+  // åˆå§‹åŒ–æ—¶æ£€æŸ¥äº‘ç«¯æ•°æ®
+  useEffect(() => {
+    checkCloudData();
+  }, []);
+
+  // åŠ è½½æœ¬åœ°æ•°æ®
+  useEffect(() => {
+    if (typeof window !== 'undefined') {
+      const savedProducts = localStorage.getItem("silverProducts");
+      const savedHistory = localStorage.getItem("silverPriceHistory");
+
+      if (savedProducts) {
+        setProducts(JSON.parse(savedProducts));
+      }
+      if (savedHistory) {
+        setPriceHistory(JSON.parse(savedHistory));
+      }
+    }
+  }, []);
+
+  // æ ¼å¼åŒ–æ—¥æœŸ
+  const formatDate = (dateString: string) => {
+    if (!dateString) return "-";
+    const date = new Date(dateString);
+    return date.toLocaleString("zh-CN", {
+      year: 'numeric',
+      month: '2-digit',
+      day: '2-digit',
+      hour: '2-digit',
+      minute: '2-digit'
+    });
+  };
+
+  // Excel å¯¼å‡º
+  const exportToExcel = () => {
+    const filteredProducts = products.filter(p => p.category === currentCategory);
+
+    if (filteredProducts.length === 0) {
+      alert("æ²¡æœ‰æ•°æ®å¯å¯¼å‡º");
+      return;
+    }
+
+    const data = filteredProducts.map(p => ({
+      "åˆ†ç±»": p.category,
+      "å­åˆ†ç±»": p.subCategory,
+      "è´§å·": p.productCode,
+      "äº§å“åç§°": p.productName,
+      "è§„æ ¼": p.specification,
+      "å…‹é‡": p.weight,
+      "å·¥è´¹": p.laborCost,
+      "é“¶è‰²": p.silverColor,
+      "é“¶ä»·": p.silverPrice,
+      "é…ä»¶æˆæœ¬": p.accessoryCost,
+      "çŸ³å¤´æˆæœ¬": p.stoneCost,
+      "ç”µé•€æˆæœ¬": p.platingCost,
+      "ä¾›åº”å•†ä»£ç ": p.supplierCode,
+      "é›¶å”®ä»·(CAD$)": p.retailPrice.toFixed(2),
+      "æ‰¹å‘ä»·(CAD$)": p.wholesalePrice.toFixed(2),
+      "å¤‡æ³¨": p.remarks,
+      "ç´¯è®¡æ•°é‡": p.quantity,
+      "æ›´æ–°æ—¶é—´": formatDate(p.timestamp),
+    }));
+
+    const ws = XLSX.utils.json_to_sheet(data);
+    const wb = XLSX.utils.book_new();
+    XLSX.utils.book_append_sheet(wb, ws, "é“¶åˆ¶å“åˆ—è¡¨");
+    XLSX.writeFile(wb, `é“¶åˆ¶å“æŠ¥ä»·_${currentCategory}_${new Date().toISOString().slice(0, 10)}.xlsx`);
+  };
+
+  // Excel å¯¼å…¥
+  const handleExcelImport = (e: React.ChangeEvent<HTMLInputElement>) => {
+    const file = e.target.files?.[0];
+    if (!file) return;
+
+    const reader = new FileReader();
+    reader.onload = (event) => {
+      const data = event.target?.result;
+      const workbook = XLSX.read(data, { type: 'binary' });
+      const sheetName = workbook.SheetNames[0];
+      const sheet = workbook.Sheets[sheetName];
+      const jsonData = XLSX.utils.sheet_to_json(sheet);
+
+      const importedProducts: SilverProduct[] = jsonData.map((row: any, index) => ({
+        id: Date.now().toString() + index,
+        category: row["åˆ†ç±»"] || row["åˆ†ç±»"] || currentCategory,
+        subCategory: row["å­åˆ†ç±»"] || row["å­åˆ†ç±»"] || SILVER_SUB_CATEGORIES[currentCategory][0],
+        productCode: row["è´§å·"] || "",
+        productName: row["äº§å“åç§°"] || "",
+        specification: row["è§„æ ¼"] || "",
+        weight: Number(row["å…‹é‡"]) || 0,
+        laborCost: Number(row["å·¥è´¹"]) || 0,
+        silverColor: row["é“¶è‰²"] || "é“¶è‰²",
+        silverPrice: silverPrice,
+        wholesalePrice: 0,
+        retailPrice: 0,
+        accessoryCost: Number(row["é…ä»¶æˆæœ¬"]) || 0,
+        stoneCost: Number(row["çŸ³å¤´æˆæœ¬"]) || 0,
+        platingCost: Number(row["ç”µé•€æˆæœ¬"]) || 0,
+        moldCost: 0,
+        commission: 0,
+        supplierCode: row["ä¾›åº”å•†ä»£ç "] || "E1",
+        remarks: row["å¤‡æ³¨"] || "",
+        quantity: Number(row["ç´¯è®¡æ•°é‡"]) || 0,
+        quantityDate: "",
+        laborCostDate: "",
+        accessoryCostDate: "",
+        stoneCostDate: "",
+        platingCostDate: "",
+        moldCostDate: "",
+        commissionDate: "",
+        timestamp: new Date().toISOString(),
+      }));
+
+      // è®¡ç®—ä»·æ ¼
+      const withPrices = importedProducts.map(p => ({
+        ...p,
+        retailPrice: calculateSilverPrice(p, true),
+        wholesalePrice: calculateSilverPrice(p, false),
+      }));
+
+      setProducts([...products, ...withPrices]);
+      saveToLocalStorage([...products, ...withPrices]);
+      alert(`æˆåŠŸå¯¼å…¥ ${importedProducts.length} ä¸ªäº§å“`);
+    };
+    reader.readAsBinaryString(file);
+  };
+
+  // ========== é¡µé¢UI ==========
 
   return (
     <div className="min-h-screen bg-gray-50 p-6">
       <AuthProtection>
         <div className="max-w-7xl mx-auto">
           {/* é¡µé¢æ ‡é¢˜ */}
-          <div className="mb-6">
-            <h1 className="text-3xl font-bold text-black mb-2">é“¶åˆ¶å“æŠ¥ä»·æ“ä½œå¹³å°</h1>
-            <p className="text-black">925é“¶åˆ¶å“ä»·æ ¼è®¡ç®—å’Œç®¡ç†ç³»ç»Ÿ</p>
+          <div className="mb-6 flex items-center justify-between">
+            <div>
+              <h1 className="text-3xl font-bold text-black mb-2">é“¶åˆ¶å“æŠ¥ä»·æ“ä½œå¹³å°</h1>
+              <p className="text-black">925é“¶åˆ¶å“ä»·æ ¼è®¡ç®—å’Œç®¡ç†ç³»ç»Ÿ</p>
+            </div>
+            <div className="relative">
+              <button
+                onClick={() => {
+                  setShowSyncMenu(!showSyncMenu);
+                  checkCloudData();
+                }}
+                className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 flex items-center gap-2"
+              >
+                <span>â˜ï¸</span>
+                <span>äº‘ç«¯åŒæ­¥</span>
+              </button>
+
+              {/* äº‘ç«¯åŒæ­¥èœå• */}
+              {showSyncMenu && (
+                <div className="absolute right-0 mt-2 w-72 bg-white rounded-lg shadow-lg border border-gray-200 z-50">
+                  <div className="py-3">
+                    <div className="px-4 pb-2 border-b border-gray-200">
+                      <div className="text-sm font-semibold text-black">äº‘ç«¯æ•°æ®åŒæ­¥</div>
+                      {cloudDataExists && (
+                        <div className="text-xs text-green-600 mt-1">âœ“ äº‘ç«¯å·²æœ‰æ•°æ®</div>
+                      )}
+                    </div>
+
+                    {/* åŒæ­¥çŠ¶æ€æ¶ˆæ¯ */}
+                    {syncStatus !== "idle" && (
+                      <div className="px-4 py-2">
+                        <div className={`text-sm ${syncStatus === "error" ? "text-red-600" : syncStatus === "success" ? "text-green-600" : "text-blue-600"}`}>
+                          {syncMessage}
+                        </div>
+                      </div>
+                    )}
+
+                    <div className="px-4 py-2 space-y-1">
+                      <button
+                        onClick={uploadToCloud}
+                        disabled={syncStatus === "syncing"}
+                        className="w-full text-left px-3 py-2 rounded hover:bg-blue-50 text-black text-sm disabled:opacity-50"
+                      >
+                        ğŸ“¤ ä¸Šä¼ åˆ°äº‘ç«¯
+                      </button>
+                      <button
+                        onClick={() => downloadFromCloud("merge")}
+                        disabled={syncStatus === "syncing"}
+                        className="w-full text-left px-3 py-2 rounded hover:bg-green-50 text-black text-sm disabled:opacity-50"
+                      >
+                        ğŸ“¥ åˆå¹¶ä¸‹è½½ï¼ˆä¿ç•™æœ¬åœ°ï¼‰
+                      </button>
+                      <button
+                        onClick={() => downloadFromCloud("replace")}
+                        disabled={syncStatus === "syncing"}
+                        className="w-full text-left px-3 py-2 rounded hover:bg-orange-50 text-black text-sm disabled:opacity-50"
+                      >
+                        ğŸ”„ è¦†ç›–ä¸‹è½½ï¼ˆæ›¿æ¢æœ¬åœ°ï¼‰
+                      </button>
+                    </div>
+
+                    <div className="px-4 pt-2 border-t border-gray-200">
+                      <div className="text-xs text-gray-500">
+                        ä¸Šä¼ åŒ…å«ï¼šäº§å“æ•°æ®ã€å†å²è®°å½•ã€é“¶ä»·è®¾ç½®ã€ä»·æ ¼ç³»æ•°
+                      </div>
+                    </div>
+                  </div>
+                </div>
+              )}
+            </div>
           </div>
 
           {/* é“¶ä»·é…ç½® */}
@@ -663,6 +1123,281 @@ function SilverQuotePage() {
             </button>
           </div>
 
+          {/* äº§å“æ“ä½œåŒº */}
+          <div className="bg-white rounded-lg shadow-md p-6 mb-6">
+            <div className="flex items-center justify-between mb-4">
+              <h2 className="text-xl font-bold text-black">äº§å“ç®¡ç†</h2>
+              <div className="flex gap-2">
+                <button
+                  onClick={addProduct}
+                  className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
+                >
+                  æ·»åŠ äº§å“
+                </button>
+                <button
+                  onClick={exportToExcel}
+                  className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600"
+                >
+                  å¯¼å‡ºExcel
+                </button>
+                <label className="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 cursor-pointer">
+                  å¯¼å…¥Excel
+                  <input type="file" accept=".xlsx,.xls" onChange={handleExcelImport} className="hidden" />
+                </label>
+              </div>
+            </div>
+
+            {/* åˆ†ç±»é€‰æ‹© */}
+            <div className="flex items-center gap-4 mb-4">
+              <span className="text-black font-medium">é€‰æ‹©åˆ†ç±»:</span>
+              <div className="flex gap-2">
+                {SILVER_PRODUCT_CATEGORIES.map(cat => (
+                  <button
+                    key={cat}
+                    onClick={() => {
+                      setCurrentCategory(cat);
+                      setCurrentSubCategory(null);
+                    }}
+                    className={`px-4 py-2 rounded ${currentCategory === cat ? 'bg-blue-500 text-white' : 'bg-gray-200 text-black hover:bg-gray-300'}`}
+                  >
+                    {cat}
+                  </button>
+                ))}
+              </div>
+            </div>
+
+            {/* å­åˆ†ç±»é€‰æ‹© */}
+            {currentCategory && SILVER_SUB_CATEGORIES[currentCategory] && (
+              <div className="flex items-center gap-4 mb-4">
+                <span className="text-black font-medium">é€‰æ‹©å­åˆ†ç±»:</span>
+                <div className="flex gap-2 flex-wrap">
+                  <button
+                    onClick={() => setCurrentSubCategory(null)}
+                    className={`px-3 py-1 rounded text-sm ${currentSubCategory === null ? 'bg-blue-500 text-white' : 'bg-gray-200 text-black hover:bg-gray-300'}`}
+                  >
+                    å…¨éƒ¨
+                  </button>
+                  {SILVER_SUB_CATEGORIES[currentCategory].map(subCat => (
+                    <button
+                      key={subCat}
+                      onClick={() => setCurrentSubCategory(subCat)}
+                      className={`px-3 py-1 rounded text-sm ${currentSubCategory === subCat ? 'bg-blue-500 text-white' : 'bg-gray-200 text-black hover:bg-gray-300'}`}
+                    >
+                      {subCat}
+                    </button>
+                  ))}
+                </div>
+              </div>
+            )}
+          </div>
+
+          {/* äº§å“åˆ—è¡¨ */}
+          <div className="bg-white rounded-lg shadow-md p-6 mb-6">
+            <h2 className="text-xl font-bold text-black mb-4">äº§å“åˆ—è¡¨</h2>
+            <div className="overflow-x-auto">
+              <table className="w-full border-collapse border border-gray-200 text-sm">
+                <thead className="bg-gray-100">
+                  <tr>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black">æ“ä½œ</th>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black">è´§å·</th>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black">äº§å“åç§°</th>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black">è§„æ ¼</th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">å…‹é‡</th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">å·¥è´¹</th>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black">é“¶è‰²</th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">é…ä»¶æˆæœ¬</th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">çŸ³å¤´æˆæœ¬</th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">ç”µé•€æˆæœ¬</th>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black">ä¾›åº”å•†ä»£ç </th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">é›¶å”®ä»·(CAD$)</th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">æ‰¹å‘ä»·(CAD$)</th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">ç´¯è®¡æ•°é‡</th>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black">å¤‡æ³¨</th>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black">æ›´æ–°æ—¶é—´</th>
+                  </tr>
+                </thead>
+                <tbody>
+                  {products.filter(p => {
+                    if (p.category !== currentCategory) return false;
+                    if (currentSubCategory && p.subCategory !== currentSubCategory) return false;
+                    return true;
+                  }).map(product => (
+                    <tr key={product.id}>
+                      <td className="border border-gray-200 px-3 py-2">
+                        <button
+                          onClick={() => deleteProduct(product.id)}
+                          className="text-red-500 hover:text-red-700"
+                        >
+                          åˆ é™¤
+                        </button>
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2">
+                        <input
+                          type="text"
+                          value={product.productCode}
+                          onChange={(e) => updateProduct(product.id, "productCode", e.target.value)}
+                          className="w-full border border-gray-200 rounded px-2 py-1 text-black"
+                        />
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2">
+                        <input
+                          type="text"
+                          value={product.productName}
+                          onChange={(e) => updateProduct(product.id, "productName", e.target.value)}
+                          className="w-full border border-gray-200 rounded px-2 py-1 text-black"
+                        />
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2">
+                        <input
+                          type="text"
+                          value={product.specification}
+                          onChange={(e) => updateProduct(product.id, "specification", e.target.value)}
+                          className="w-full border border-gray-200 rounded px-2 py-1 text-black"
+                        />
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2">
+                        <input
+                          type="number"
+                          step="0.01"
+                          value={product.weight}
+                          onChange={(e) => updateProduct(product.id, "weight", Number(e.target.value))}
+                          className="w-full border border-gray-200 rounded px-2 py-1 text-black text-right"
+                        />
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2">
+                        <input
+                          type="number"
+                          step="0.01"
+                          value={product.laborCost}
+                          onChange={(e) => updateProduct(product.id, "laborCost", Number(e.target.value))}
+                          className="w-full border border-gray-200 rounded px-2 py-1 text-black text-right"
+                        />
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2">
+                        <select
+                          value={product.silverColor}
+                          onChange={(e) => updateProduct(product.id, "silverColor", e.target.value as any)}
+                          className="w-full border border-gray-200 rounded px-2 py-1 text-black"
+                        >
+                          <option value="é“¶è‰²">é“¶è‰²</option>
+                          <option value="é•€é‡‘">é•€é‡‘</option>
+                          <option value="é•€ç«ç‘°é‡‘">é•€ç«ç‘°é‡‘</option>
+                          <option value="é“¶è‰²/é•€é‡‘/é•€ç«ç‘°é‡‘">é“¶è‰²/é•€é‡‘/é•€ç«ç‘°é‡‘</option>
+                        </select>
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2">
+                        <input
+                          type="number"
+                          step="0.01"
+                          value={product.accessoryCost}
+                          onChange={(e) => updateProduct(product.id, "accessoryCost", Number(e.target.value))}
+                          className="w-full border border-gray-200 rounded px-2 py-1 text-black text-right"
+                        />
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2">
+                        <input
+                          type="number"
+                          step="0.01"
+                          value={product.stoneCost}
+                          onChange={(e) => updateProduct(product.id, "stoneCost", Number(e.target.value))}
+                          className="w-full border border-gray-200 rounded px-2 py-1 text-black text-right"
+                        />
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2">
+                        <input
+                          type="number"
+                          step="0.01"
+                          value={product.platingCost}
+                          onChange={(e) => updateProduct(product.id, "platingCost", Number(e.target.value))}
+                          className="w-full border border-gray-200 rounded px-2 py-1 text-black text-right"
+                        />
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2">
+                        <input
+                          type="text"
+                          value={product.supplierCode}
+                          onChange={(e) => updateProduct(product.id, "supplierCode", e.target.value)}
+                          className="w-full border border-gray-200 rounded px-2 py-1 text-black"
+                        />
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2 text-right font-bold text-blue-700">
+                        {product.retailPrice.toFixed(2)}
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2 text-right font-bold text-green-700">
+                        {product.wholesalePrice.toFixed(2)}
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2 text-right">
+                        {product.quantity || 0}
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2">
+                        <input
+                          type="text"
+                          value={product.remarks}
+                          onChange={(e) => updateProduct(product.id, "remarks", e.target.value)}
+                          className="w-full border border-gray-200 rounded px-2 py-1 text-black"
+                        />
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2 text-xs text-black">
+                        {formatDate(product.timestamp)}
+                      </td>
+                    </tr>
+                  ))}
+                  {products.filter(p => p.category === currentCategory).length === 0 && (
+                    <tr>
+                      <td colSpan={17} className="border border-gray-200 px-3 py-4 text-center text-black">
+                        æš‚æ— {currentCategory}äº§å“æ•°æ®
+                      </td>
+                    </tr>
+                  )}
+                </tbody>
+              </table>
+            </div>
+          </div>
+
+          {/* å†å²è®°å½• */}
+          <div className="bg-white rounded-lg shadow-md p-6 mb-6">
+            <h2 className="text-xl font-bold text-black mb-4">ä»·æ ¼å†å²è®°å½•</h2>
+            <div className="overflow-x-auto" style={{ maxHeight: '400px' }}>
+              <table className="w-full border-collapse border border-gray-200 text-sm">
+                <thead className="bg-gray-100 sticky top-0">
+                  <tr>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black">æ—¶é—´</th>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black">è´§å·</th>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black">åç§°</th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">å…‹é‡</th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">å·¥è´¹</th>
+                    <th className="border border-gray-200 px-3 py-2 text-left text-black">é“¶è‰²</th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">é›¶å”®ä»·</th>
+                    <th className="border border-gray-200 px-3 py-2 text-right text-black">æ‰¹å‘ä»·</th>
+                  </tr>
+                </thead>
+                <tbody>
+                  {priceHistory.filter(h => h.category === currentCategory).slice(0, 100).map(history => (
+                    <tr key={history.id}>
+                      <td className="border border-gray-200 px-3 py-2 whitespace-nowrap text-black text-xs">
+                        {formatDate(history.timestamp)}
+                      </td>
+                      <td className="border border-gray-200 px-3 py-2 text-black">{history.productCode}</td>
+                      <td className="border border-gray-200 px-3 py-2 text-black">{history.productName}</td>
+                      <td className="border border-gray-200 px-3 py-2 text-right text-black">{history.weight}</td>
+                      <td className="border border-gray-200 px-3 py-2 text-right text-black">{history.laborCost}</td>
+                      <td className="border border-gray-200 px-3 py-2 text-black">{history.silverColor}</td>
+                      <td className="border border-gray-200 px-3 py-2 text-right text-black">{history.retailPrice.toFixed(2)}</td>
+                      <td className="border border-gray-200 px-3 py-2 text-right text-black">{history.wholesalePrice.toFixed(2)}</td>
+                    </tr>
+                  ))}
+                  {priceHistory.filter(h => h.category === currentCategory).length === 0 && (
+                    <tr>
+                      <td colSpan={8} className="border border-gray-200 px-3 py-4 text-center text-black">
+                        æš‚æ— å†å²è®°å½•
+                      </td>
+                    </tr>
+                  )}
+                </tbody>
+              </table>
+            </div>
+          </div>
+
           {/* è¿”å›é‡‘åˆ¶å“é¡µé¢ */}
           <div className="text-center">
             <button
-- 
2.43.0

